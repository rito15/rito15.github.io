<!DOCTYPE html>



<html lang="en" 
  
    mode="dark"
  
>

  <!--
  The Head
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme" content="Chirpy v2.7.2">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="물리 기반 캐릭터 이동 구현하기" />
<meta name="author" content="Rito15" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="목차 1. 서론 2. 이동 스크립트 분리 3. 요구사항 정리 4. 필드, 프로퍼티 정의 5. 상태 검사 구현 6. 중력 적용 7. 이동 구현 8. 물리 상호작용 9. 구현 결과 10. 소스 코드" />
<meta property="og:description" content="목차 1. 서론 2. 이동 스크립트 분리 3. 요구사항 정리 4. 필드, 프로퍼티 정의 5. 상태 검사 구현 6. 중력 적용 7. 이동 구현 8. 물리 상호작용 9. 구현 결과 10. 소스 코드" />
<link rel="canonical" href="https://rito15.github.io/posts/unity-physics-based-movement/" />
<meta property="og:url" content="https://rito15.github.io/posts/unity-physics-based-movement/" />
<meta property="og:site_name" content="Rito15" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-25T04:11:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="물리 기반 캐릭터 이동 구현하기" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"목차 1. 서론 2. 이동 스크립트 분리 3. 요구사항 정리 4. 필드, 프로퍼티 정의 5. 상태 검사 구현 6. 중력 적용 7. 이동 구현 8. 물리 상호작용 9. 구현 결과 10. 소스 코드","datePublished":"2021-02-25T04:11:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rito15.github.io/posts/unity-physics-based-movement/"},"url":"https://rito15.github.io/posts/unity-physics-based-movement/","author":{"@type":"Person","name":"Rito15"},"headline":"물리 기반 캐릭터 이동 구현하기","dateModified":"2021-03-01T02:57:04+09:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>물리 기반 캐릭터 이동 구현하기 | Rito15
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2019 Cotes Chung
  Published under the MIT license
-->



<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->






<link rel="preload" href="/assets/css/post.css" as="style">
<link rel="stylesheet" href="/assets/css/post.css">


  
    <link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css">
    <link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" />
  



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->





<script async src="/assets/js/post.min.js"></script>


  <!-- MathJax -->
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>





</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/favicons/android-icon-192x192.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Rito15</a>
    </div>

    <div class="site-subtitle font-italic">Unity Csharp Developer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/tabs/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/rito15" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ghdtkals15','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
      
        
        <span>
          <a href="/">
            Posts
          </a>
        </span>
        
      

      
        <span>물리 기반 캐릭터 이동 구현하기</span>
      

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>물리 기반 캐릭터 이동 구현하기</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Thu, Feb 25, 2021,  4:11 AM +0900"
  >

  
  

  
    Feb 25
  

  <i class="unloaded">2021-02-25T04:11:00+09:00</i>

</span>
          by
          <span class="author">
            Rito15
          </span>
        </div>

        <div>
          <!-- lastmod -->
          
          <span>
            Updated
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago lastmod"
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Mon, Mar  1, 2021,  2:57 AM +0900"
  >

  
  

  
    Mar  1
  

  <i class="unloaded">2021-03-01T02:57:04+09:00</i>

</span>
          </span>
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->






<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7326 words">40 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h1 id="목차">목차</h1>
<hr />
<ul>
  <li><a href="#서론">1. 서론</a></li>
  <li><a href="#이동-스크립트-분리">2. 이동 스크립트 분리</a></li>
  <li><a href="#요구사항">3. 요구사항 정리</a></li>
  <li><a href="#필드-프로퍼티-정의">4. 필드, 프로퍼티 정의</a></li>
  <li><a href="#상태-검사">5. 상태 검사 구현</a></li>
  <li><a href="#중력">6. 중력 적용</a></li>
  <li><a href="#이동-구현하기">7. 이동 구현</a></li>
  <li><a href="#물리-상호작용">8. 물리 상호작용</a></li>
  <li><a href="#구현-결과">9. 구현 결과</a></li>
  <li><a href="#source-code">10. 소스 코드</a></li>
</ul>

<p><br /></p>

<h1 id="서론">서론</h1>
<hr />

<p>유니티에서 캐릭터 이동을 구현하기 위한 방법들은 다양하다.</p>

<ul>
  <li>Transform</li>
  <li>Rigidbody</li>
  <li>Character Controller</li>
  <li>NavMeshAgent</li>
  <li>…</li>
</ul>

<p>트랜스폼, 내비메시 에이전트를 통해 이동을 구현하면 물리 상호작용을 할 수 없고,</p>

<p>캐릭터 컨트롤러를 통해 구현해도 다른 콜라이더에 상호작용을 하려면 콜라이더가 따로 필요하고,</p>

<p>다른 강체로부터 상호작용을 받으려면 역시 리지드바디가 따로 필요한데다가 캐릭터 콜라이더는 비활성화된 상태여야 한다.</p>

<p>따라서 리지드바디를 이용해 이동을 구현하려 한다.</p>

<p>그리고 리지드바디를 이용해 물리 기반 이동을 구현하는 방법은 두 가지로 나눌 수 있다.</p>

<p>첫째는 Rigidbody.MovePosition()을 이용하는 것, 두 번째는 Rigidbody.velocity를 직접 조절하는 것이다.</p>

<p>이 포스트에서는 velocity를 제어하여 리지드바디 기반 이동을 구현한다.</p>

<p><br /></p>

<h1 id="이동-스크립트-분리">이동 스크립트 분리</h1>
<hr />

<p>키보드 입력을 통한 이동 및 회전 벡터 초기화, 캐릭터 회전은 모두 앞선 포스트에서 작성한 CharacterMainController를 사용하며,</p>

<p>이 포스트에서는 월드 이동 벡터를 전달받아 이동만 담당하는 스크립트를 분리하여 작성한다.</p>

<p>그리고 이동 스크립트를 다양하게 작성해도 동일하게 메인 컨트롤러에서 사용할 수 있도록 인터페이스로 묶는다.</p>

<p><br /></p>

<details>
  <summary> 
IMovement3D.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">interface</span> <span class="nc">IMovement3D</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt; 현재 이동 중인지 여부 &lt;/summary&gt;</span>
    <span class="kt">bool</span> <span class="nf">IsMoving</span><span class="p">();</span>
    <span class="c1">/// &lt;summary&gt; 지면에 닿아 있는지 여부 &lt;/summary&gt;</span>
    <span class="kt">bool</span> <span class="nf">IsGrounded</span><span class="p">();</span>
    <span class="c1">/// &lt;summary&gt; 지면으로부터의 거리 &lt;/summary&gt;</span>
    <span class="kt">float</span> <span class="nf">GetDistanceFromGround</span><span class="p">();</span>

    <span class="c1">/// &lt;summary&gt; 월드 이동벡터 초기화(이동 명령) &lt;/summary&gt;</span>
    <span class="k">void</span> <span class="nf">SetMovement</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldMoveDirection</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isRunning</span><span class="p">);</span>
    <span class="c1">/// &lt;summary&gt; 점프 명령 - 점프 성공 여부 리턴 &lt;/summary&gt;</span>
    <span class="kt">bool</span> <span class="nf">SetJump</span><span class="p">();</span>
    <span class="c1">/// &lt;summary&gt; 이동 중지 &lt;/summary&gt;</span>
    <span class="k">void</span> <span class="nf">StopMoving</span><span class="p">();</span>

    <span class="c1">/// &lt;summary&gt; 밀쳐내기 &lt;/summary&gt;</span>
    <span class="k">void</span> <span class="nf">KnockBack</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">force</span><span class="p">,</span> <span class="kt">float</span> <span class="n">time</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="요구사항">요구사항</h1>
<hr />

<h2 id="상태-검사">상태 검사</h2>
<ul>
  <li>현재 캐릭터가 지면을 딛고 있는지 항상 검사해야 한다.</li>
  <li>캐릭터가 이동하는 방향에 장애물이 있는지 검사해야 한다.</li>
  <li>경사면의 각도를 항상 검사해야 한다.</li>
</ul>

<h2 id="이동">이동</h2>
<ul>
  <li>지상에서 캐릭터는 항상 경사면을 따라 이동한다.</li>
  <li>공중에서 캐릭터는 월드 XZ 평면 방향으로 이동한다.</li>
</ul>

<h2 id="중력">중력</h2>
<ul>
  <li>캐릭터는 지상에 있을 때 중력의 영향을 받지 않는다. (경사면을 따라 미끄러지지 않는다.)</li>
  <li>캐릭터는 공중에 있을 때 중력의 영향을 받는다.</li>
</ul>

<h2 id="이동-제한">이동 제한</h2>
<ul>
  <li>제한 경사각 이상의 각도를 가진 경사면에는 이동할 수 없어야 한다.</li>
  <li>제한 경사각 이상의 각도를 가진 경사면에 위치할 경우, 중력을 적용하여 미끄러지게 한다.</li>
</ul>

<h2 id="점프">점프</h2>
<ul>
  <li>다중 점프를 할 수 있어야 한다.</li>
  <li>첫 점프는 지상에 있을때만 가능하다.</li>
</ul>

<p><br /></p>

<h1 id="필드-프로퍼티-정의">필드, 프로퍼티 정의</h1>
<hr />

<p>스크립트 내에서 사용할 필드, 프로퍼티를 정의한다.</p>

<details>
  <summary> 
Data Class Definitions
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Components</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span> <span class="k">public</span> <span class="n">CapsuleCollider</span> <span class="n">capsule</span><span class="p">;</span>
    <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span> <span class="k">public</span> <span class="n">Rigidbody</span> <span class="n">rBody</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CheckOption</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Tooltip</span><span class="p">(</span><span class="s">"지면으로 체크할 레이어 설정"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">LayerMask</span> <span class="n">groundLayerMask</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.01f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"전방 감지 거리"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">forwardCheckDistance</span> <span class="p">=</span> <span class="m">0.1f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.1f</span><span class="p">,</span> <span class="m">10.0f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"지면 감지 거리"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">groundCheckDistance</span> <span class="p">=</span> <span class="m">2.0f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.1f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"지면 인식 허용 거리"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">groundCheckThreshold</span> <span class="p">=</span> <span class="m">0.01f</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">MovementOption</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"이동속도"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">speed</span> <span class="p">=</span> <span class="m">5f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">3f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"달리기 이동속도 증가 계수"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">runningCoef</span> <span class="p">=</span> <span class="m">1.5f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"점프 강도"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">jumpForce</span> <span class="p">=</span> <span class="m">4.2f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">2.0f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"점프 쿨타임"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">jumpCooldown</span> <span class="p">=</span> <span class="m">0.6f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"점프 허용 횟수"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">maxJumpCount</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">70f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"등반 가능한 경사각"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">maxSlopeAngle</span> <span class="p">=</span> <span class="m">50f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="m">4f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"경사로 이동속도 변화율(가속/감속)"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">slopeAccel</span> <span class="p">=</span> <span class="m">1f</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(-</span><span class="m">9.81f</span><span class="p">,</span> <span class="m">0f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"중력"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">gravity</span> <span class="p">=</span> <span class="p">-</span><span class="m">9.81f</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CurrentState</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isMoving</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isRunning</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isGrounded</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isOnSteepSlope</span><span class="p">;</span>   <span class="c1">// 등반 불가능한 경사로에 올라와 있음</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isJumpTriggered</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isJumping</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isForwardBlocked</span><span class="p">;</span> <span class="c1">// 전방에 장애물 존재</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">isOutOfControl</span><span class="p">;</span>   <span class="c1">// 제어 불가 상태</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CurrentValue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">worldMoveDir</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">groundNormal</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">groundCross</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">horizontalVelocity</span><span class="p">;</span>

    <span class="p">[</span><span class="n">Space</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">jumpCooldown</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">int</span>   <span class="n">jumpCount</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">outOfControllDuration</span><span class="p">;</span>

    <span class="p">[</span><span class="n">Space</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">groundDistance</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">groundSlopeAngle</span><span class="p">;</span>         <span class="c1">// 현재 바닥의 경사각</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">groundVerticalSlopeAngle</span><span class="p">;</span> <span class="c1">// 수직으로 재측정한 경사각</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">forwardSlopeAngle</span><span class="p">;</span> <span class="c1">// 캐릭터가 바라보는 방향의 경사각</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">slopeAccel</span><span class="p">;</span>        <span class="c1">// 경사로 인한 가속/감속 비율</span>

    <span class="p">[</span><span class="n">Space</span><span class="p">]</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">gravity</span><span class="p">;</span> <span class="c1">// 직접 제어하는 중력값</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<details>
  <summary> 
Variables, Properties
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">Components</span>       <span class="n">_components</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Components</span><span class="p">();</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">CheckOption</span>   <span class="n">_checkOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CheckOption</span><span class="p">();</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">MovementOption</span> <span class="n">_moveOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MovementOption</span><span class="p">();</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">CurrentState</span> <span class="n">_currentStates</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CurrentState</span><span class="p">();</span>
<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">CurrentValue</span> <span class="n">_currentValues</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CurrentValue</span><span class="p">();</span>

<span class="k">private</span> <span class="n">Components</span>     <span class="n">Com</span>     <span class="p">=&gt;</span> <span class="n">_components</span><span class="p">;</span>
<span class="k">private</span> <span class="n">CheckOption</span>    <span class="n">COption</span> <span class="p">=&gt;</span> <span class="n">_checkOptions</span><span class="p">;</span>
<span class="k">private</span> <span class="n">MovementOption</span> <span class="n">MOption</span> <span class="p">=&gt;</span> <span class="n">_moveOptions</span><span class="p">;</span>
<span class="k">private</span> <span class="n">CurrentState</span>   <span class="n">State</span>   <span class="p">=&gt;</span> <span class="n">_currentStates</span><span class="p">;</span>
<span class="k">private</span> <span class="n">CurrentValue</span>   <span class="n">Current</span> <span class="p">=&gt;</span> <span class="n">_currentValues</span><span class="p">;</span>


<span class="k">private</span> <span class="kt">float</span> <span class="n">_capsuleRadiusDiff</span><span class="p">;</span>
<span class="k">private</span> <span class="kt">float</span> <span class="n">_fixedDeltaTime</span><span class="p">;</span>

<span class="k">private</span> <span class="kt">float</span> <span class="n">_castRadius</span><span class="p">;</span> <span class="c1">// Sphere, Capsule 레이캐스트 반지름</span>

<span class="k">private</span> <span class="n">Vector3</span> <span class="n">CapsuleTopCenterPoint</span> 
    <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">height</span> <span class="p">-</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

<span class="k">private</span> <span class="n">Vector3</span> <span class="n">CapsuleBottomCenterPoint</span> 
    <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="상태-검사-1">상태 검사</h1>
<hr />

<p>물리적 상태를 검사하기 위한 방법으로 우선 레이캐스트를 생각해볼 수 있다.</p>

<p>흔히 사용하는 방법으로, 캐릭터 중심 좌표에서 수직 하향 레이캐스트를 하여 바닥까지의 거리를 검사할 수 있다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109267741-68bd8d80-784d-11eb-9781-fef83cc0d671.png" alt="image" /></p>

<p>하지만 위와 같이 캐릭터가 지형에 걸쳐있는 경우, 부정확한 결과를 얻게 된다.</p>

<p><br /></p>

<p>그렇다면 캐릭터의 네 모퉁이에서 각각 레이캐스트를 하여 결과를 OR 연산으로 사용하면 어떨까?</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109268112-f7caa580-784d-11eb-93fe-6baa3aa092e8.png" alt="image" /></p>

<p>평지, 큐브, 균일한 경사면에서는 나쁘지 않은 결과를 얻을 수 있지만</p>

<p>언덕, 산간 지형, 불규칙한 지형에서는 이마저도 정확한 결과를 얻는다는 보장이 없다.</p>

<p><br /></p>

<p>다음으로 생각해볼 수 있는 것들은 OnCollision~, ~Cast, Rigidbody.SweepTest가 있다.</p>

<p>OnCollision류의 이벤트 메소드는 항상 모든 방위를 검사하는 데다가, Enter, Exit을 모두 다루어줘야 하고, FixedDeltaTime 주기 밖에서 변화가 발생하여 이벤트를 감지하지 못할 가능성이 존재하며, Stay는 오버헤드가 크다.</p>

<p>SweepTest는 콜라이더에 맞닿아있는 경우 감지할 수 없으며, 이를 보완하기 위해서는 캐릭터의 콜라이더 크기보다 조금 더 작은 또다른 콜라이더와 그에 부착할 리지드바디가 필요한데, 캐릭터에 두 개의 리지드바디와 콜라이더를 사용하는 것은 성능의 낭비라고 할 수 있다(실제로 해보았다).</p>

<p><br /></p>

<p>결국 최종적인 선택은 ~Cast (Sphere, Capsule, Box, …) 이다.</p>

<p>캐릭터에는 캡슐 콜라이더를 사용할 것이므로 지면 감지에는 SphereCast, 전방 장애물 감지에는 CapsuleCast를 사용한다.</p>

<p><br /></p>

<h2 id="1-전방-장애물-검사"><strong>[1] 전방 장애물 검사</strong></h2>

<p>전방을 검사하는 코드는 비교적 간단하다.</p>

<p>캐릭터의 캡슐 콜라이더와 같은, 혹은 좀더 작은 크기(같은 크기로 검사하면 전방 180도를 모두 감지하게 되므로)의 캡슐 캐스트를 현재 이동 방향으로 검사한다.</p>

<p>캐스트 거리는 인스펙터를 통해 조정하며, 보통 0.1 정도로 사용한다.</p>

<details>
  <summary> 
Source Code
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">CheckForward</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">cast</span> <span class="p">=</span>
        <span class="n">Physics</span><span class="p">.</span><span class="nf">CapsuleCast</span><span class="p">(</span><span class="n">CapsuleBottomCenterPoint</span><span class="p">,</span> <span class="n">CapsuleTopCenterPoint</span><span class="p">,</span> <span class="n">_castRadius</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">down</span> <span class="p">*</span> <span class="m">0.1f</span><span class="p">,</span>
            <span class="k">out</span> <span class="kt">var</span> <span class="n">hit</span><span class="p">,</span> <span class="n">COption</span><span class="p">.</span><span class="n">forwardCheckDistance</span><span class="p">,</span> <span class="p">-</span><span class="m">1</span><span class="p">,</span> <span class="n">QueryTriggerInteraction</span><span class="p">.</span><span class="n">Ignore</span><span class="p">);</span>

    <span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">forwardObstacleAngle</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Angle</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">=</span> <span class="n">forwardObstacleAngle</span> <span class="p">&gt;=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="2-지면-검사"><strong>[2] 지면 검사</strong></h2>

<p>하단방향 지면 검사를 통해 다음의 정보들을 얻어낸다.</p>

<ul>
  <li>
    <p>캐릭터와 지면 사이의 거리(높이)</p>
  </li>
  <li>
    <p>캐릭터가 현재 지면에 위치해 있는지 여부</p>
  </li>
  <li>
    <p>지면의 경사각(기울기)</p>
  </li>
  <li>캐릭터가 이동할 방향을 기준으로 하는 경사각
    <ul>
      <li>캐릭터가 이동할 방향의 실제 경사각을 구한다.</li>
    </ul>
  </li>
  <li>현재 캐릭터가 오를 수 없는 경사면에 위치해 있는지 여부
    <ul>
      <li>이 정보를 이용해 추후 이동 구현시 오를 수 없는 경사면에 있을 경우 미끄러지게 한다.</li>
    </ul>
  </li>
  <li>경사면의 회전축 벡터
    <ul>
      <li>캐릭터가 경사면을 따라 이동할 수 있도록, 월드 이동 벡터를 회전시키기 위한 기준이 된다.</li>
    </ul>
  </li>
</ul>

<details>
  <summary> 
Source Code
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">CheckGround</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">=</span> <span class="kt">float</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">;</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">;</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">cast</span> <span class="p">=</span>
        <span class="n">Physics</span><span class="p">.</span><span class="nf">SphereCast</span><span class="p">(</span><span class="n">CapsuleBottomCenterPoint</span><span class="p">,</span> <span class="n">_castRadius</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">down</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">hit</span><span class="p">,</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckDistance</span><span class="p">,</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundLayerMask</span><span class="p">,</span> <span class="n">QueryTriggerInteraction</span><span class="p">.</span><span class="n">Ignore</span><span class="p">);</span>

    <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 지면 노멀벡터 초기화</span>
        <span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span> <span class="p">=</span> <span class="n">hit</span><span class="p">.</span><span class="n">normal</span><span class="p">;</span>

        <span class="c1">// 현재 위치한 지면의 경사각 구하기(캐릭터 이동방향 고려)</span>
        <span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Angle</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Angle</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span><span class="p">)</span> <span class="p">-</span> <span class="m">90f</span><span class="p">;</span>

        <span class="n">State</span><span class="p">.</span><span class="n">isOnSteepSlope</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span> <span class="p">&gt;=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">;</span>

        <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="n">distance</span> <span class="p">-</span> <span class="n">_capsuleRadiusDiff</span> <span class="p">-</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckThreshold</span><span class="p">,</span> <span class="p">-</span><span class="m">10f</span><span class="p">);</span>

        <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">=</span>
            <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">&lt;=</span> <span class="m">0.0001f</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isOnSteepSlope</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 월드 이동벡터 회전축</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Cross</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="중력-1">중력</h1>
<hr />

<h2 id="중력이-작용하는-경우"><strong>중력이 작용하는 경우</strong></h2>

<ul>
  <li>
    <p>캐릭터가 공중에 떠있는 경우</p>
  </li>
  <li>
    <p>캐릭터가 오를수 없는 경사면에 위치한 경우</p>
  </li>
</ul>

<p><br /></p>

<h2 id="중력이-작용하지-않는-경우"><strong>중력이 작용하지 않는 경우</strong></h2>

<ul>
  <li>캐릭터가 지면에 위치한 경우</li>
</ul>

<p><br /></p>

<h2 id="중력의-직접-제어"><strong>중력의 직접 제어</strong></h2>

<p>리지드바디의 useGravity를 사용할 경우, 중력은 내부적으로 velocity 값의 변화를 통해 적용된다.</p>

<p>Rigidbody.Move()를 사용하면 그저 useGravity를 사용하고 중력을 신경쓰지 않아도 된다.</p>

<p>그리고 수평 속도만을 조정한다면 Rigidbody.velocity.y는 그대로 두고 x, z 값만 조정할 수도 있다.</p>

<p>그런데 지금은 Rigidbody.Move()가 아니라 velocity를 직접 조정하는데다가, 경사면에서 수평 벡터를 회전시켜 결국 y 속도에도 영향을 주어야 한다.</p>

<p>따라서 useGravity를 false로 두고 직접 중력 값을 제어하여 사용한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">+=</span> <span class="n">_fixedDeltaTime</span> <span class="p">*</span> <span class="n">MOption</span><span class="p">.</span><span class="n">gravity</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<h1 id="이동-구현하기">이동 구현하기</h1>
<hr />

<p>구현 순서대로 작성한다.</p>

<p><br /></p>

<h2 id="1-점프"><strong>[1] 점프</strong></h2>

<p>점프는 현재 적용된 중력 값을 점프력 값으로 초기화하는 방식을 통해 간단히 구현할 수 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>여기에서 확장하여, 다중 점프와 쿨타임을 고려하여 작성한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span><span class="p">;</span>

    <span class="c1">// 점프 쿨타임, 트리거 초기화</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpCooldown</span><span class="p">;</span>
    <span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span><span class="p">++;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>점프는 현재 gravity 값에 양수의 점프력 값을 초기화하여 구현한다.</p>

<p>메인 컨트롤러로부터 점프 명령을 받으면 isJumpTriggered 값이 true로 초기화되며, 위 코드에서 이를 감지하여 점프를 하게 된다.</p>

<p>jumpCooldown(현재 점프 쿨타임)은 0보다 클 경우 Update 또는 FixedUpdate에서 값을 항상 감소시킨다.</p>

<p>jumpCount(현재 누적 점프 횟수)는 grounded 상태가 되었을 때 0으로 제한하며, 점프 명령을 내리는 메소드에서 jumpCount가 일정 횟수 이상이면 점프하지 않도록 횟수 제한을 할 수 있다.</p>

<p>isJumping 변수는 캐릭터가 공중에 있게 된 원인이 단순히 뛰어내린 것인지, 점프로 인한 것인지 구분할 수 있게 해주며 마찬가지로 grounded 상태가 되었을 때 false로 초기화한다.</p>

<p><br /></p>

<h2 id="2-xz-평면-이동"><strong>[2] XZ 평면 이동</strong></h2>

<p>기본적인 XZ 평면 방향 이동 벡터는 월드 이동 방향 벡터에 이동속도를 곱해주는 방식으로 초기화할 수 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kt">float</span> <span class="n">speed</span> <span class="p">=</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isMoving</span>  <span class="p">?</span> <span class="m">0f</span> <span class="p">:</span>
              <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isRunning</span> <span class="p">?</span> <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">:</span>
                                 <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">*</span> <span class="n">MOption</span><span class="p">.</span><span class="n">runningCoef</span><span class="p">;</span>

<span class="c1">// XZ 이동벡터</span>
<span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">*</span> <span class="n">speed</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>그리고 여러가지 조건을 고려할 수 있다.</p>

<p>조건을 아예 설정하지 않은 경우, 벽으로 이동하며 점프했을 때 점프가 되지 않거나 매달려버리는 경우가 발생한다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109301358-2f9c1200-787b-11eb-90a8-5e5903faed35.gif" alt="2021_0226_Move3" /></p>

<p><br /></p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">if</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>기존의 조건대로 전방이 막혀있으면 아예 전방 이동이 불가능하게 할 수도 있지만, 벽에 살짝만 닿아도 캐릭터가 정지하는 등 조작감에 있어서 불편함을 느낄 수 있다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109300785-5443ba00-787a-11eb-8c7f-f9ed978562d0.gif" alt="2021_0226_Move1" /></p>

<p><br /></p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">||</span> <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">&amp;&amp;</span> <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></div></div>

<p>따라서 위처럼 조건을 지정하여 지상에서는 자유롭게 이동하도록 하고, 공중에서만 전방이 막힌 경우 속도를 0으로 초기화하여 벽에 매달리는 현상을 방지한다.</p>

<p>그리고 <code class="language-plaintext highlighter-rouge">State.isJumping &amp;&amp; State.isGrounded</code> 조건은 점프하는 순간에 벽에 매달려 점프하지 못하는 현상을 방지해준다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109301044-b00e4300-787a-11eb-8522-88c55b9c7257.gif" alt="2021_0226_Move2" /></p>

<p><br /></p>

<h2 id="3-xz-벡터-회전"><strong>[3] XZ 벡터 회전</strong></h2>

<p>지면 검사 메소드에서 얻어냈던 경사면 회전축 벡터(groundCross)를 이용하여, XZ 평면의 이동벡터를 경사면에 평행하도록 회전시킨다.</p>

<p>그리고 그 전에, 캐릭터가 향하는 방향의 경사각(forwardSlopeAngle)을 이용하여 경사에 의한 가속/감속을 적용한다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">// 경사로 인한 가속/감속</span>
<span class="k">if</span> <span class="p">(</span><span class="n">MOption</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">&gt;</span> <span class="m">0f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">isPlus</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">&gt;=</span> <span class="m">0f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">absFsAngle</span> <span class="p">=</span> <span class="n">isPlus</span> <span class="p">?</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">:</span> <span class="p">-</span><span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">accel</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">*</span> <span class="n">absFsAngle</span> <span class="p">*</span> <span class="m">0.01111f</span> <span class="p">+</span> <span class="m">1f</span><span class="p">;</span>
    <span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">=</span> <span class="p">!</span><span class="n">isPlus</span> <span class="p">?</span> <span class="n">accel</span> <span class="p">:</span> <span class="m">1.0f</span> <span class="p">/</span> <span class="n">accel</span><span class="p">;</span>

    <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">*=</span> <span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 벡터 회전</span>
<span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span>
    <span class="n">Quaternion</span><span class="p">.</span><span class="nf">AngleAxis</span><span class="p">(-</span><span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span><span class="p">)</span> <span class="p">*</span> <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><br /></p>

<p>여기서도 조건들을 고려해볼 수 있다.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">&amp;&amp;</span> <span class="n">State</span><span class="p">.</span><span class="n">isMoving</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이렇게 지면에 붙어있을 때만 XZ 벡터를 회전시키면 캐릭터가 경사면을 내려올 때 경사면을 타고 내려오지 않고 허공으로 뛰어내리는 현상이 발생한다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109301582-83a6f680-787b-11eb-8809-7fcc14907a10.gif" alt="2021_0226_Move4" /></p>

<p><br /></p>

<p>따라서</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">||</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">&lt;</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckDistance</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isJumping</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
    <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isMoving</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span><span class="p">)</span> <span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이렇게, 점프를 하지 않은 상태에서 지면에 가까이 위치한 경우도 경사면에 따라 벡터를 회전시키도록 설정한다.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109303016-7d197e80-787d-11eb-89e2-f5ae18138ff8.gif" alt="2021_0226_Move5" /></p>

<p><br /></p>

<h2 id="결과">결과</h2>

<details>
  <summary> 
Source Code
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">CalculateMovements</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 1. 점프</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span><span class="p">;</span>

        <span class="c1">// 점프 쿨타임, 트리거 초기화</span>
        <span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpCooldown</span><span class="p">;</span>
        <span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span><span class="p">++;</span>
    <span class="p">}</span>

    <span class="c1">// 2. XZ 이동속도 계산</span>
    <span class="c1">// 공중에서 전방이 막힌 경우 제한 (지상에서는 벽에 붙어서 이동할 수 있도록 허용)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">||</span> <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">&amp;&amp;</span> <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="c1">// 이동 가능한 경우 : 지상 or 전방이 막히지 않음</span>
    <span class="p">{</span>
        <span class="kt">float</span> <span class="n">speed</span> <span class="p">=</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isMoving</span>  <span class="p">?</span> <span class="m">0f</span> <span class="p">:</span>
                      <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isRunning</span> <span class="p">?</span> <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">:</span>
                                         <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">*</span> <span class="n">MOption</span><span class="p">.</span><span class="n">runningCoef</span><span class="p">;</span>

        <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">*</span> <span class="n">speed</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 3. XZ 벡터 회전</span>
    <span class="c1">// 지상이거나 지면에 가까운 높이</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">||</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">&lt;</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckDistance</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isJumping</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isMoving</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 경사로 인한 가속/감속</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">MOption</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">&gt;</span> <span class="m">0f</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">bool</span> <span class="n">isPlus</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">&gt;=</span> <span class="m">0f</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">absFsAngle</span> <span class="p">=</span> <span class="n">isPlus</span> <span class="p">?</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">:</span> <span class="p">-</span><span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">accel</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">*</span> <span class="n">absFsAngle</span> <span class="p">*</span> <span class="m">0.01111f</span> <span class="p">+</span> <span class="m">1f</span><span class="p">;</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">=</span> <span class="p">!</span><span class="n">isPlus</span> <span class="p">?</span> <span class="n">accel</span> <span class="p">:</span> <span class="m">1.0f</span> <span class="p">/</span> <span class="n">accel</span><span class="p">;</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">*=</span> <span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// 벡터 회전 (경사로)</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span>
                <span class="n">Quaternion</span><span class="p">.</span><span class="nf">AngleAxis</span><span class="p">(-</span><span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span><span class="p">)</span> <span class="p">*</span> <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h2 id="리지드바디에-속도-적용">리지드바디에 속도 적용</h2>

<div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">velocity</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">gravity</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>XZ 이동속도를 계산한 벡터와 중력 벡터를 더하여 리지드바디에 적용하면 된다.</p>

<p>경사면에서 XZ 벡터가 회전하므로, y값이 0이 아니라는 점에 유의해야 한다.</p>

<p><br /></p>

<h1 id="물리-상호작용">물리 상호작용</h1>
<hr />

<p>리지드바디의 velocity를 직접 수정하게 되면 외부의 힘을 전달받아도 이를 덮어씌우기 때문에 사실상 자연스러운 물리적 상호작용을 기대하기 힘들다.</p>

<p>따라서 몇 가지 방법이 있는데,</p>

<p><br /></p>

<p>첫 번째는 외부 힘을 받아 속도에 합산하는 로직을 직접 작성하여 메소드로 제공하는 것이다.</p>

<p>그런데 이 방법은 유니티 물리엔진 내부 구현의 일부를 다시 직접 하는 것이나 다름없기 때문에 애초에 속도를 직접 수정하지 않는 방식을 선택하는 것이 좋다.</p>

<p><br /></p>

<p>두 번째는 일시적으로 직접적인 제어가 불가능한 상태를 만드는 것이다.</p>

<p>외부에서 강제적인 힘의 개입이 필요할 때, 리지드바디의 속도 수정을 중단하고 자연스럽게 물리엔진의 계산대로 동작하도록 한다.</p>

<p>넉백의 구현을 예로 들 수 있다.</p>

<p>넉백 순간에 일시적으로 제어가 불가능한 상태를 만들고 힘을 가한 뒤, 일정 시간 후에 제어를 되찾는 방식으로 구현할 수 있다.</p>

<p><br /></p>

<p>이 포스팅에서는 두 번째 방법을 간단히 구현하였다.</p>

<p><br /></p>

<h1 id="구현-결과">구현 결과</h1>
<hr />

<h2 id="1-3인칭-뷰">[1] 3인칭 뷰</h2>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109312876-e653be80-788a-11eb-90b6-f2f815b129f0.gif" alt="2021_0226_PBM1" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109312918-f370ad80-788a-11eb-87bb-d4b9c7b0050c.gif" alt="2021_0226_PBM2" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109312947-fe2b4280-788a-11eb-8be4-964f8bc1f42f.gif" alt="2021_0226_PBM3" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109312957-008d9c80-788b-11eb-9ef1-963026727302.gif" alt="2021_0226_PBM4" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109312963-02576000-788b-11eb-8348-cfcd8757a778.gif" alt="2021_0226_PBM5" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109312969-04212380-788b-11eb-92bf-22f72f1ce251.gif" alt="2021_0226_PBM6" /></p>

<p><br /></p>

<h2 id="2-1인칭-뷰">[2] 1인칭 뷰</h2>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109314538-d4731b00-788c-11eb-8815-3f5f47ac8d03.gif" alt="2021_0226_PBM_FP_1" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109314546-d6d57500-788c-11eb-895e-31797cfa4a91.gif" alt="2021_0226_PBM_FP_2" /></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/42164422/109314552-d937cf00-788c-11eb-9015-678b25cdba6e.gif" alt="2021_0226_PBM_FP_3" /></p>

<p><br /></p>

<h1 id="source-code">Source Code</h1>
<hr />

<details>
  <summary> 
PhysicsBasedMovement.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="c1">// 날짜 : 2021-02-21 PM 8:23:22</span>
<span class="c1">// 작성자 : Rito</span>

<span class="c1">// 단점 : 오를 수 없는 경사면으로 이동하려고 시도할 경우 지터링 발생</span>

<span class="k">namespace</span> <span class="nn">Rito.CharacterControl</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PhysicsBasedMovement</span> <span class="p">:</span> <span class="n">MonoBehaviour</span><span class="p">,</span> <span class="n">IMovement3D</span>
    <span class="p">{</span>
        <span class="cm">/***********************************************************************
        *                               Definitions
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
        <span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">Components</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span> <span class="k">public</span> <span class="n">CapsuleCollider</span> <span class="n">capsule</span><span class="p">;</span>
            <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span> <span class="k">public</span> <span class="n">Rigidbody</span> <span class="n">rBody</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">CheckOption</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="nf">Tooltip</span><span class="p">(</span><span class="s">"지면으로 체크할 레이어 설정"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="n">LayerMask</span> <span class="n">groundLayerMask</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.01f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"전방 감지 거리"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">forwardCheckDistance</span> <span class="p">=</span> <span class="m">0.1f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.1f</span><span class="p">,</span> <span class="m">10.0f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"지면 감지 거리"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">groundCheckDistance</span> <span class="p">=</span> <span class="m">2.0f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">0.1f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"지면 인식 허용 거리"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">groundCheckThreshold</span> <span class="p">=</span> <span class="m">0.01f</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">MovementOption</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"이동속도"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">speed</span> <span class="p">=</span> <span class="m">5f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">3f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"달리기 이동속도 증가 계수"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">runningCoef</span> <span class="p">=</span> <span class="m">1.5f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"점프 강도"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">jumpForce</span> <span class="p">=</span> <span class="m">4.2f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.0f</span><span class="p">,</span> <span class="m">2.0f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"점프 쿨타임"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">jumpCooldown</span> <span class="p">=</span> <span class="m">0.6f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"점프 허용 횟수"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">int</span> <span class="n">maxJumpCount</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">75f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"등반 가능한 경사각"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">maxSlopeAngle</span> <span class="p">=</span> <span class="m">50f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="m">4f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"경사로 이동속도 변화율(가속/감속)"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">slopeAccel</span> <span class="p">=</span> <span class="m">1f</span><span class="p">;</span>

            <span class="p">[</span><span class="nf">Range</span><span class="p">(-</span><span class="m">9.81f</span><span class="p">,</span> <span class="m">0f</span><span class="p">),</span> <span class="nf">Tooltip</span><span class="p">(</span><span class="s">"중력"</span><span class="p">)]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">gravity</span> <span class="p">=</span> <span class="p">-</span><span class="m">9.81f</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">CurrentState</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isMoving</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isRunning</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isGrounded</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isOnSteepSlope</span><span class="p">;</span>   <span class="c1">// 등반 불가능한 경사로에 올라와 있음</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isJumpTriggered</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isJumping</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isForwardBlocked</span><span class="p">;</span> <span class="c1">// 전방에 장애물 존재</span>
            <span class="k">public</span> <span class="kt">bool</span> <span class="n">isOutOfControl</span><span class="p">;</span>   <span class="c1">// 제어 불가 상태</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">CurrentValue</span>
        <span class="p">{</span>
            <span class="k">public</span> <span class="n">Vector3</span> <span class="n">worldMoveDir</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">Vector3</span> <span class="n">groundNormal</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">Vector3</span> <span class="n">groundCross</span><span class="p">;</span>
            <span class="k">public</span> <span class="n">Vector3</span> <span class="n">horizontalVelocity</span><span class="p">;</span>

            <span class="p">[</span><span class="n">Space</span><span class="p">]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">jumpCooldown</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">int</span>   <span class="n">jumpCount</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">outOfControllDuration</span><span class="p">;</span>

            <span class="p">[</span><span class="n">Space</span><span class="p">]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">groundDistance</span><span class="p">;</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">groundSlopeAngle</span><span class="p">;</span>         <span class="c1">// 현재 바닥의 경사각</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">groundVerticalSlopeAngle</span><span class="p">;</span> <span class="c1">// 수직으로 재측정한 경사각</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">forwardSlopeAngle</span><span class="p">;</span> <span class="c1">// 캐릭터가 바라보는 방향의 경사각</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">slopeAccel</span><span class="p">;</span>        <span class="c1">// 경사로 인한 가속/감속 비율</span>

            <span class="p">[</span><span class="n">Space</span><span class="p">]</span>
            <span class="k">public</span> <span class="kt">float</span> <span class="n">gravity</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Variables
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

        <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">Components</span> <span class="n">_components</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Components</span><span class="p">();</span>
        <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">CheckOption</span> <span class="n">_checkOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CheckOption</span><span class="p">();</span>
        <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">MovementOption</span> <span class="n">_moveOptions</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MovementOption</span><span class="p">();</span>
        <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">CurrentState</span> <span class="n">_currentStates</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CurrentState</span><span class="p">();</span>
        <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span> <span class="k">private</span> <span class="n">CurrentValue</span> <span class="n">_currentValues</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CurrentValue</span><span class="p">();</span>

        <span class="k">private</span> <span class="n">Components</span> <span class="n">Com</span> <span class="p">=&gt;</span> <span class="n">_components</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">CheckOption</span> <span class="n">COption</span> <span class="p">=&gt;</span> <span class="n">_checkOptions</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">MovementOption</span> <span class="n">MOption</span> <span class="p">=&gt;</span> <span class="n">_moveOptions</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">CurrentState</span> <span class="n">State</span> <span class="p">=&gt;</span> <span class="n">_currentStates</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">CurrentValue</span> <span class="n">Current</span> <span class="p">=&gt;</span> <span class="n">_currentValues</span><span class="p">;</span>


        <span class="k">private</span> <span class="kt">float</span> <span class="n">_capsuleRadiusDiff</span><span class="p">;</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_fixedDeltaTime</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">float</span> <span class="n">_castRadius</span><span class="p">;</span> <span class="c1">// Sphere, Capsule 레이캐스트 반지름</span>
        <span class="k">private</span> <span class="n">Vector3</span> <span class="n">CapsuleTopCenterPoint</span> 
            <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">height</span> <span class="p">-</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
        <span class="k">private</span> <span class="n">Vector3</span> <span class="n">CapsuleBottomCenterPoint</span> 
            <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Unity Events
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">InitRigidbody</span><span class="p">();</span>
            <span class="nf">InitCapsuleCollider</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">FixedUpdate</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_fixedDeltaTime</span> <span class="p">=</span> <span class="n">Time</span><span class="p">.</span><span class="n">fixedDeltaTime</span><span class="p">;</span>

            <span class="nf">CheckGround</span><span class="p">();</span>
            <span class="nf">CheckForward</span><span class="p">();</span>

            <span class="nf">UpdatePhysics</span><span class="p">();</span>
            <span class="nf">UpdateValues</span><span class="p">();</span>

            <span class="nf">CalculateMovements</span><span class="p">();</span>
            <span class="nf">ApplyMovementsToRigidbody</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Init Methods
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">InitRigidbody</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">TryGetComponent</span><span class="p">(</span><span class="k">out</span> <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Com</span><span class="p">.</span><span class="n">rBody</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>

            <span class="c1">// 회전은 자식 트랜스폼을 통해 직접 제어할 것이기 때문에 리지드바디 회전은 제한</span>
            <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">constraints</span> <span class="p">=</span> <span class="n">RigidbodyConstraints</span><span class="p">.</span><span class="n">FreezeRotation</span><span class="p">;</span>
            <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">interpolation</span> <span class="p">=</span> <span class="n">RigidbodyInterpolation</span><span class="p">.</span><span class="n">Interpolate</span><span class="p">;</span>
            <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">collisionDetectionMode</span> <span class="p">=</span> <span class="n">CollisionDetectionMode</span><span class="p">.</span><span class="n">ContinuousDynamic</span><span class="p">;</span>
            <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">useGravity</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// 중력 직접 제어</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">InitCapsuleCollider</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">TryGetComponent</span><span class="p">(</span><span class="k">out</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Com</span><span class="p">.</span><span class="n">capsule</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">CapsuleCollider</span><span class="p">&gt;();</span>

                <span class="c1">// 렌더러를 모두 탐색하여 높이 결정</span>
                <span class="kt">float</span> <span class="n">maxHeight</span> <span class="p">=</span> <span class="p">-</span><span class="m">1f</span><span class="p">;</span>

                <span class="c1">// 1. SMR 확인</span>
                <span class="kt">var</span> <span class="n">smrArr</span> <span class="p">=</span> <span class="n">GetComponentsInChildren</span><span class="p">&lt;</span><span class="n">SkinnedMeshRenderer</span><span class="p">&gt;();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">smrArr</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">smr</span> <span class="k">in</span> <span class="n">smrArr</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">vertex</span> <span class="k">in</span> <span class="n">smr</span><span class="p">.</span><span class="n">sharedMesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="n">maxHeight</span> <span class="p">&lt;</span> <span class="n">vertex</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
                                <span class="n">maxHeight</span> <span class="p">=</span> <span class="n">vertex</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="c1">// 2. MR 확인</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">mfArr</span> <span class="p">=</span> <span class="n">GetComponentsInChildren</span><span class="p">&lt;</span><span class="n">MeshFilter</span><span class="p">&gt;();</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">mfArr</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">mf</span> <span class="k">in</span> <span class="n">mfArr</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">vertex</span> <span class="k">in</span> <span class="n">mf</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">vertices</span><span class="p">)</span>
                            <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">maxHeight</span> <span class="p">&lt;</span> <span class="n">vertex</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
                                    <span class="n">maxHeight</span> <span class="p">=</span> <span class="n">vertex</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// 3. 캡슐 콜라이더 값 설정</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">maxHeight</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
                    <span class="n">maxHeight</span> <span class="p">=</span> <span class="m">1f</span><span class="p">;</span>

                <span class="kt">float</span> <span class="n">center</span> <span class="p">=</span> <span class="n">maxHeight</span> <span class="p">*</span> <span class="m">0.5f</span><span class="p">;</span>

                <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">height</span> <span class="p">=</span> <span class="n">maxHeight</span><span class="p">;</span>
                <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">center</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="n">center</span><span class="p">;</span>
                <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span> <span class="p">=</span> <span class="m">0.2f</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">_castRadius</span> <span class="p">=</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span> <span class="p">*</span> <span class="m">0.9f</span><span class="p">;</span>
            <span class="n">_capsuleRadiusDiff</span> <span class="p">=</span> <span class="n">Com</span><span class="p">.</span><span class="n">capsule</span><span class="p">.</span><span class="n">radius</span> <span class="p">-</span> <span class="n">_castRadius</span> <span class="p">+</span> <span class="m">0.05f</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Public Methods
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

        <span class="kt">bool</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">IsMoving</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">State</span><span class="p">.</span><span class="n">isMoving</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">IsGrounded</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">GetDistanceFromGround</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span><span class="p">;</span>

        <span class="k">void</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">SetMovement</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">worldMoveDir</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isRunning</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">=</span> <span class="n">worldMoveDir</span><span class="p">;</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isMoving</span> <span class="p">=</span> <span class="n">worldMoveDir</span><span class="p">.</span><span class="n">sqrMagnitude</span> <span class="p">&gt;</span> <span class="m">0.01f</span><span class="p">;</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isRunning</span> <span class="p">=</span> <span class="n">isRunning</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">bool</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">SetJump</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// 첫 점프는 지면 위에서만 가능</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">&amp;&amp;</span> <span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

            <span class="c1">// 점프 쿨타임, 횟수 확인</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">&gt;</span> <span class="m">0f</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span> <span class="p">&gt;=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxJumpCount</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

            <span class="c1">// 접근 불가능 경사로에서 점프 불가능</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isOnSteepSlope</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

            <span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">StopMoving</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isMoving</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isRunning</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IMovement3D</span><span class="p">.</span><span class="nf">KnockBack</span><span class="p">(</span><span class="k">in</span> <span class="n">Vector3</span> <span class="n">force</span><span class="p">,</span> <span class="kt">float</span> <span class="n">time</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">SetOutOfControl</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
            <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="nf">AddForce</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">ForceMode</span><span class="p">.</span><span class="n">Impulse</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">SetOutOfControl</span><span class="p">(</span><span class="kt">float</span> <span class="n">time</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">outOfControllDuration</span> <span class="p">=</span> <span class="n">time</span><span class="p">;</span>
            <span class="nf">ResetJump</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Private Methods
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">ResetJump</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt; 하단 지면 검사 &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">CheckGround</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">=</span> <span class="kt">float</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">;</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">;</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>

            <span class="kt">bool</span> <span class="n">cast</span> <span class="p">=</span>
                <span class="n">Physics</span><span class="p">.</span><span class="nf">SphereCast</span><span class="p">(</span><span class="n">CapsuleBottomCenterPoint</span><span class="p">,</span> <span class="n">_castRadius</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">down</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">hit</span><span class="p">,</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckDistance</span><span class="p">,</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundLayerMask</span><span class="p">,</span> <span class="n">QueryTriggerInteraction</span><span class="p">.</span><span class="n">Ignore</span><span class="p">);</span>

            <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">// 지면 노멀벡터 초기화</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span> <span class="p">=</span> <span class="n">hit</span><span class="p">.</span><span class="n">normal</span><span class="p">;</span>

                <span class="c1">// 현재 위치한 지면의 경사각 구하기(캐릭터 이동방향 고려)</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Angle</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Angle</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span><span class="p">)</span> <span class="p">-</span> <span class="m">90f</span><span class="p">;</span>

                <span class="n">State</span><span class="p">.</span><span class="n">isOnSteepSlope</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span> <span class="p">&gt;=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">;</span>

                <span class="c1">// 경사각 이중검증 (수직 레이캐스트) : 뾰족하거나 각진 부분 체크</span>
                <span class="c1">//if (State.isOnSteepSlope)</span>
                <span class="c1">//{</span>
                <span class="c1">//    Vector3 ro = hit.point + Vector3.up * 0.1f;</span>
                <span class="c1">//    Vector3 rd = Vector3.down;</span>
                <span class="c1">//    bool rayD = </span>
                <span class="c1">//        Physics.SphereCast(ro, 0.09f, rd, out var hitRayD, 0.2f, COption.groundLayerMask, QueryTriggerInteraction.Ignore);</span>

                <span class="c1">//    Current.groundVerticalSlopeAngle = rayD ? Vector3.Angle(hitRayD.normal, Vector3.up) : Current.groundSlopeAngle;</span>

                <span class="c1">//    State.isOnSteepSlope = Current.groundVerticalSlopeAngle &gt;= MOption.maxSlopeAngle;</span>
                <span class="c1">//}</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="n">distance</span> <span class="p">-</span> <span class="n">_capsuleRadiusDiff</span> <span class="p">-</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckThreshold</span><span class="p">,</span> <span class="m">0f</span><span class="p">);</span>

                <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">=</span>
                    <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">&lt;=</span> <span class="m">0.0001f</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isOnSteepSlope</span><span class="p">;</span>

                <span class="nf">GzUpdateValue</span><span class="p">(</span><span class="k">ref</span> <span class="n">_gzGroundTouch</span><span class="p">,</span> <span class="n">hit</span><span class="p">.</span><span class="n">point</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// 월드 이동벡터 회전축</span>
            <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Cross</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundNormal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt; 전방 장애물 검사 : 레이어 관계 없이 trigger가 아닌 모든 장애물 검사 &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">CheckForward</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">cast</span> <span class="p">=</span>
                <span class="n">Physics</span><span class="p">.</span><span class="nf">CapsuleCast</span><span class="p">(</span><span class="n">CapsuleBottomCenterPoint</span><span class="p">,</span> <span class="n">CapsuleTopCenterPoint</span><span class="p">,</span> <span class="n">_castRadius</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">down</span> <span class="p">*</span> <span class="m">0.1f</span><span class="p">,</span>
                    <span class="k">out</span> <span class="kt">var</span> <span class="n">hit</span><span class="p">,</span> <span class="n">COption</span><span class="p">.</span><span class="n">forwardCheckDistance</span><span class="p">,</span> <span class="p">-</span><span class="m">1</span><span class="p">,</span> <span class="n">QueryTriggerInteraction</span><span class="p">.</span><span class="n">Ignore</span><span class="p">);</span>

            <span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">float</span> <span class="n">forwardObstacleAngle</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Angle</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
                <span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">=</span> <span class="n">forwardObstacleAngle</span> <span class="p">&gt;=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">;</span>

                <span class="nf">GzUpdateValue</span><span class="p">(</span><span class="k">ref</span> <span class="n">_gzForwardTouch</span><span class="p">,</span> <span class="n">hit</span><span class="p">.</span><span class="n">point</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">UpdatePhysics</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Custom Gravity, Jumping State</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">+=</span> <span class="n">_fixedDeltaTime</span> <span class="p">*</span> <span class="n">MOption</span><span class="p">.</span><span class="n">gravity</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">UpdateValues</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Calculate Jump Cooldown</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">&gt;</span> <span class="m">0f</span><span class="p">)</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">-=</span> <span class="n">_fixedDeltaTime</span><span class="p">;</span>

            <span class="c1">// Out Of Control</span>
            <span class="n">State</span><span class="p">.</span><span class="n">isOutOfControl</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">outOfControllDuration</span> <span class="p">&gt;</span> <span class="m">0f</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isOutOfControl</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">outOfControllDuration</span> <span class="p">-=</span> <span class="n">_fixedDeltaTime</span><span class="p">;</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">CalculateMovements</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isOutOfControl</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// 0. 가파른 경사면에 있는 경우 : 꼼짝말고 미끄럼틀 타기</span>
            <span class="c1">//if (State.isOnSteepSlope &amp;&amp; Current.groundDistance &lt; 0.1f)</span>
            <span class="c1">//{</span>
            <span class="c1">//    DebugMark(0);</span>

            <span class="c1">//    Current.horizontalVelocity =</span>
            <span class="c1">//        Quaternion.AngleAxis(90f - Current.groundSlopeAngle, Current.groundCross) * (Vector3.up * Current.gravity);</span>

            <span class="c1">//    Com.rBody.velocity = Current.horizontalVelocity;</span>

            <span class="c1">//    return;</span>
            <span class="c1">//}</span>

            <span class="c1">// 1. 점프</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span> <span class="p">&amp;&amp;</span> <span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">&lt;=</span> <span class="m">0f</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">DebugMark</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span><span class="p">;</span>

                <span class="c1">// 점프 쿨타임, 트리거 초기화</span>
                <span class="n">Current</span><span class="p">.</span><span class="n">jumpCooldown</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpCooldown</span><span class="p">;</span>
                <span class="n">State</span><span class="p">.</span><span class="n">isJumpTriggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">jumpCount</span><span class="p">++;</span>
            <span class="p">}</span>

            <span class="c1">// 2. XZ 이동속도 계산</span>
            <span class="c1">// 공중에서 전방이 막힌 경우 제한 (지상에서는 벽에 붙어서 이동할 수 있도록 허용)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">||</span> <span class="n">State</span><span class="p">.</span><span class="n">isJumping</span> <span class="p">&amp;&amp;</span> <span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">)</span> 
            <span class="p">{</span>
                <span class="nf">DebugMark</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="c1">// 이동 가능한 경우 : 지상 or 전방이 막히지 않음</span>
            <span class="p">{</span>
                <span class="nf">DebugMark</span><span class="p">(</span><span class="m">3</span><span class="p">);</span>

                <span class="kt">float</span> <span class="n">speed</span> <span class="p">=</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isMoving</span>  <span class="p">?</span> <span class="m">0f</span> <span class="p">:</span>
                              <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isRunning</span> <span class="p">?</span> <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">:</span>
                                                 <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">*</span> <span class="n">MOption</span><span class="p">.</span><span class="n">runningCoef</span><span class="p">;</span>

                <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">worldMoveDir</span> <span class="p">*</span> <span class="n">speed</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// 3. XZ 벡터 회전</span>
            <span class="c1">// 지상이거나 지면에 가까운 높이</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isGrounded</span> <span class="p">||</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span> <span class="p">&lt;</span> <span class="n">COption</span><span class="p">.</span><span class="n">groundCheckDistance</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isJumping</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isMoving</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="nf">DebugMark</span><span class="p">(</span><span class="m">4</span><span class="p">);</span>

                    <span class="c1">// 경사로 인한 가속/감속</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">MOption</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">&gt;</span> <span class="m">0f</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">bool</span> <span class="n">isPlus</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">&gt;=</span> <span class="m">0f</span><span class="p">;</span>
                        <span class="kt">float</span> <span class="n">absFsAngle</span> <span class="p">=</span> <span class="n">isPlus</span> <span class="p">?</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">:</span> <span class="p">-</span><span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span><span class="p">;</span>
                        <span class="kt">float</span> <span class="n">accel</span> <span class="p">=</span> <span class="n">MOption</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">*</span> <span class="n">absFsAngle</span> <span class="p">*</span> <span class="m">0.01111f</span> <span class="p">+</span> <span class="m">1f</span><span class="p">;</span>
                        <span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span> <span class="p">=</span> <span class="p">!</span><span class="n">isPlus</span> <span class="p">?</span> <span class="n">accel</span> <span class="p">:</span> <span class="m">1.0f</span> <span class="p">/</span> <span class="n">accel</span><span class="p">;</span>

                        <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">*=</span> <span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="c1">// 벡터 회전 (경사로)</span>
                    <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">=</span>
                        <span class="n">Quaternion</span><span class="p">.</span><span class="nf">AngleAxis</span><span class="p">(-</span><span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span><span class="p">)</span> <span class="p">*</span> <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nf">GzUpdateValue</span><span class="p">(</span><span class="k">ref</span> <span class="n">_gzRotatedWorldMoveDir</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">*</span> <span class="m">0.2f</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt; 리지드바디 최종 속도 적용 &lt;/summary&gt;</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">ApplyMovementsToRigidbody</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isOutOfControl</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">velocity</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Current</span><span class="p">.</span><span class="n">gravity</span><span class="p">,</span> <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">Com</span><span class="p">.</span><span class="n">rBody</span><span class="p">.</span><span class="n">velocity</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span> <span class="p">+</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">gravity</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Debugs
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="n">_debugOn</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">_debugIndex</span><span class="p">;</span>

        <span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"UNITY_EDITOR"</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">DebugMark</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(!</span><span class="n">_debugOn</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MARK - "</span> <span class="p">+</span> <span class="n">index</span><span class="p">);</span>
            <span class="n">_debugIndex</span> <span class="p">=</span> <span class="n">index</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
        <span class="cm">/***********************************************************************
        *                               Gizmos, GUI
        ***********************************************************************/</span>
        <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

        <span class="k">private</span> <span class="n">Vector3</span> <span class="n">_gzGroundTouch</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Vector3</span> <span class="n">_gzForwardTouch</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">Vector3</span> <span class="n">_gzRotatedWorldMoveDir</span><span class="p">;</span>

        <span class="p">[</span><span class="nf">Header</span><span class="p">(</span><span class="s">"Gizmos Option"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">_showGizmos</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="p">[</span><span class="n">SerializeField</span><span class="p">,</span> <span class="nf">Range</span><span class="p">(</span><span class="m">0.01f</span><span class="p">,</span> <span class="m">2f</span><span class="p">)]</span>
        <span class="k">private</span> <span class="kt">float</span> <span class="n">_gizmoRadius</span> <span class="p">=</span> <span class="m">0.05f</span><span class="p">;</span>

        <span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"UNITY_EDITOR"</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">void</span> <span class="nf">OnDrawGizmos</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">isPlaying</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">_showGizmos</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(!</span><span class="n">enabled</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

            <span class="n">Gizmos</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">;</span>
            <span class="n">Gizmos</span><span class="p">.</span><span class="nf">DrawSphere</span><span class="p">(</span><span class="n">_gzGroundTouch</span><span class="p">,</span> <span class="n">_gizmoRadius</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">isForwardBlocked</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Gizmos</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">blue</span><span class="p">;</span>
                <span class="n">Gizmos</span><span class="p">.</span><span class="nf">DrawSphere</span><span class="p">(</span><span class="n">_gzForwardTouch</span><span class="p">,</span> <span class="n">_gizmoRadius</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">Gizmos</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">blue</span><span class="p">;</span>
            <span class="n">Gizmos</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="n">_gzGroundTouch</span> <span class="p">-</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span><span class="p">,</span> <span class="n">_gzGroundTouch</span> <span class="p">+</span> <span class="n">Current</span><span class="p">.</span><span class="n">groundCross</span><span class="p">);</span>

            <span class="n">Gizmos</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">black</span><span class="p">;</span>
            <span class="n">Gizmos</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">_gzRotatedWorldMoveDir</span><span class="p">);</span>

            <span class="n">Gizmos</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Color</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">0.8f</span><span class="p">,</span> <span class="m">0.8f</span><span class="p">);</span>
            <span class="n">Gizmos</span><span class="p">.</span><span class="nf">DrawWireSphere</span><span class="p">(</span><span class="n">CapsuleTopCenterPoint</span><span class="p">,</span> <span class="n">_castRadius</span><span class="p">);</span>
            <span class="n">Gizmos</span><span class="p">.</span><span class="nf">DrawWireSphere</span><span class="p">(</span><span class="n">CapsuleBottomCenterPoint</span><span class="p">,</span> <span class="n">_castRadius</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="nf">Conditional</span><span class="p">(</span><span class="s">"UNITY_EDITOR"</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">void</span> <span class="n">GzUpdateValue</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">ref</span> <span class="n">T</span> <span class="n">variable</span><span class="p">,</span> <span class="k">in</span> <span class="n">T</span> <span class="k">value</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">variable</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="p">}</span>



        <span class="p">[</span><span class="n">SerializeField</span><span class="p">,</span> <span class="n">Space</span><span class="p">]</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">_showGUI</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
        <span class="k">private</span> <span class="kt">int</span> <span class="n">_guiTextSize</span> <span class="p">=</span> <span class="m">28</span><span class="p">;</span>

        <span class="k">private</span> <span class="kt">float</span> <span class="n">_prevForwardSlopeAngle</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">isPlaying</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">_showGUI</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">enabled</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

            <span class="n">GUIStyle</span> <span class="n">labelStyle</span> <span class="p">=</span> <span class="n">GUI</span><span class="p">.</span><span class="n">skin</span><span class="p">.</span><span class="n">label</span><span class="p">;</span>
            <span class="n">labelStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">textColor</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">yellow</span><span class="p">;</span>
            <span class="n">labelStyle</span><span class="p">.</span><span class="n">fontSize</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="n">_guiTextSize</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>

            <span class="n">_prevForwardSlopeAngle</span> <span class="p">=</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span> <span class="p">==</span> <span class="p">-</span><span class="m">90f</span> <span class="p">?</span> <span class="n">_prevForwardSlopeAngle</span> <span class="p">:</span> <span class="n">Current</span><span class="p">.</span><span class="n">forwardSlopeAngle</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">oldColor</span> <span class="p">=</span> <span class="n">GUI</span><span class="p">.</span><span class="n">color</span><span class="p">;</span>
            <span class="n">GUI</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Color</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="m">0f</span><span class="p">,</span> <span class="m">0f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">);</span>
            <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">40</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="m">420</span><span class="p">,</span> <span class="m">260</span><span class="p">),</span> <span class="s">""</span><span class="p">);</span>
            <span class="n">GUI</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">oldColor</span><span class="p">;</span>

            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">BeginArea</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="m">1000</span><span class="p">,</span> <span class="m">500</span><span class="p">));</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="s">$"Ground Height : </span><span class="p">{</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Min</span><span class="p">(</span><span class="n">Current</span><span class="p">.</span><span class="n">groundDistance</span><span class="p">,</span> <span class="m">99.99f</span><span class="p">):</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">labelStyle</span><span class="p">);</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="s">$"Slope Angle(Ground)  : </span><span class="p">{</span><span class="n">Current</span><span class="p">.</span><span class="n">groundSlopeAngle</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">labelStyle</span><span class="p">);</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="s">$"Slope Angle(Forward) : </span><span class="p">{</span><span class="n">_prevForwardSlopeAngle</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">labelStyle</span><span class="p">);</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="s">$"Allowed Slope Angle : </span><span class="p">{</span><span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">labelStyle</span><span class="p">);</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="s">$"Current Slope Accel : </span><span class="p">{</span><span class="n">Current</span><span class="p">.</span><span class="n">slopeAccel</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">labelStyle</span><span class="p">);</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="s">$"Current Speed Mag  : </span><span class="p">{</span><span class="n">Current</span><span class="p">.</span><span class="n">horizontalVelocity</span><span class="p">.</span><span class="n">magnitude</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">labelStyle</span><span class="p">);</span>
            <span class="n">GUILayout</span><span class="p">.</span><span class="nf">EndArea</span><span class="p">();</span>

            <span class="kt">float</span> <span class="n">sWidth</span> <span class="p">=</span> <span class="n">Screen</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">sHeight</span> <span class="p">=</span> <span class="n">Screen</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>

            <span class="n">GUIStyle</span> <span class="n">RTLabelStyle</span> <span class="p">=</span> <span class="n">GUI</span><span class="p">.</span><span class="n">skin</span><span class="p">.</span><span class="n">label</span><span class="p">;</span>
            <span class="n">RTLabelStyle</span><span class="p">.</span><span class="n">fontSize</span> <span class="p">=</span> <span class="m">20</span><span class="p">;</span>
            <span class="n">RTLabelStyle</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">textColor</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">green</span><span class="p">;</span>

            <span class="n">oldColor</span> <span class="p">=</span> <span class="n">GUI</span><span class="p">.</span><span class="n">color</span><span class="p">;</span>
            <span class="n">GUI</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Color</span><span class="p">(</span><span class="m">1f</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">);</span>
            <span class="n">GUI</span><span class="p">.</span><span class="nf">Box</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">355f</span><span class="p">,</span> <span class="m">5f</span><span class="p">,</span> <span class="m">340f</span><span class="p">,</span> <span class="m">100f</span><span class="p">),</span> <span class="s">""</span><span class="p">);</span>
            <span class="n">GUI</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">oldColor</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">yPos</span> <span class="p">=</span> <span class="m">10f</span><span class="p">;</span>
            <span class="n">GUI</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">350f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">,</span> <span class="m">150f</span><span class="p">,</span> <span class="m">30f</span><span class="p">),</span> <span class="s">$"Speed : </span><span class="p">{</span><span class="n">MOption</span><span class="p">.</span><span class="n">speed</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">RTLabelStyle</span><span class="p">);</span>
            <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span> <span class="p">=</span> <span class="n">GUI</span><span class="p">.</span><span class="nf">HorizontalSlider</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">200f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">+</span><span class="m">10f</span><span class="p">,</span> <span class="m">180f</span><span class="p">,</span> <span class="m">20f</span><span class="p">),</span> <span class="n">MOption</span><span class="p">.</span><span class="n">speed</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">);</span>

            <span class="n">yPos</span> <span class="p">+=</span> <span class="m">20f</span><span class="p">;</span>
            <span class="n">GUI</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">350f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">,</span> <span class="m">150f</span><span class="p">,</span> <span class="m">30f</span><span class="p">),</span> <span class="s">$"Jump : </span><span class="p">{</span><span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span><span class="p">:</span> <span class="m">00.00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">RTLabelStyle</span><span class="p">);</span>
            <span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span> <span class="p">=</span> <span class="n">GUI</span><span class="p">.</span><span class="nf">HorizontalSlider</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">200f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">+</span> <span class="m">10f</span><span class="p">,</span> <span class="m">180f</span><span class="p">,</span> <span class="m">20f</span><span class="p">),</span> <span class="n">MOption</span><span class="p">.</span><span class="n">jumpForce</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">10f</span><span class="p">);</span>

            <span class="n">yPos</span> <span class="p">+=</span> <span class="m">20f</span><span class="p">;</span>
            <span class="n">GUI</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">350f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">,</span> <span class="m">150f</span><span class="p">,</span> <span class="m">30f</span><span class="p">),</span> <span class="s">$"Jump Count : </span><span class="p">{</span><span class="n">MOption</span><span class="p">.</span><span class="n">maxJumpCount</span><span class="p">:</span> <span class="m">0</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">RTLabelStyle</span><span class="p">);</span>
            <span class="n">MOption</span><span class="p">.</span><span class="n">maxJumpCount</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">GUI</span><span class="p">.</span><span class="nf">HorizontalSlider</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">200f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">+</span> <span class="m">10f</span><span class="p">,</span> <span class="m">180f</span><span class="p">,</span> <span class="m">20f</span><span class="p">),</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxJumpCount</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">3f</span><span class="p">);</span>

            <span class="n">yPos</span> <span class="p">+=</span> <span class="m">20f</span><span class="p">;</span>
            <span class="n">GUI</span><span class="p">.</span><span class="nf">Label</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">350f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">,</span> <span class="m">150f</span><span class="p">,</span> <span class="m">30f</span><span class="p">),</span> <span class="s">$"Max Slope : </span><span class="p">{</span><span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">:</span> <span class="m">00</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">RTLabelStyle</span><span class="p">);</span>
            <span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">GUI</span><span class="p">.</span><span class="nf">HorizontalSlider</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">sWidth</span> <span class="p">-</span> <span class="m">200f</span><span class="p">,</span> <span class="n">yPos</span><span class="p">+</span> <span class="m">10f</span><span class="p">,</span> <span class="m">180f</span><span class="p">,</span> <span class="m">20f</span><span class="p">),</span> <span class="n">MOption</span><span class="p">.</span><span class="n">maxSlopeAngle</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">75f</span><span class="p">);</span>

            <span class="n">labelStyle</span><span class="p">.</span><span class="n">fontSize</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="n">_guiTextSize</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="err">#</span><span class="n">endregion</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/unity/'>Unity</a>,
            <a href='/categories/unity-study/'>Unity Study</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/unity/"
            class="post-tag no-text-decoration" >unity</a>
          
          <a href="/tags/csharp/"
            class="post-tag no-text-decoration" >csharp</a>
          
          <a href="/tags/physics/"
            class="post-tag no-text-decoration" >physics</a>
          
          <a href="/tags/movement/"
            class="post-tag no-text-decoration" >movement</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet

 v2.1
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=물리 기반 캐릭터 이동 구현하기 - Rito15&url=https://rito15.github.io/posts/unity-physics-based-movement/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=물리 기반 캐릭터 이동 구현하기 - Rito15&u=https://rito15.github.io/posts/unity-physics-based-movement/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=물리 기반 캐릭터 이동 구현하기 - Rito15&url=https://rito15.github.io/posts/unity-physics-based-movement/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/unity-transparent-stencil/">유니티 반투명, 스텐실 개념 익히기</a></li>
      
        
        
        
        <li><a href="/posts/unity-toy-model-pivot-resetter/">Model Pivot Resetter</a></li>
      
        
        
        
        <li><a href="/posts/unity-shader-property-attributes/">유니티 쉐이더 프로퍼티 애트리뷰트 모음</a></li>
      
        
        
        
        <li><a href="/posts/unity-shader-compilation/">유니티 쉐이더 모음</a></li>
      
        
        
        
        <li><a href="/posts/unity-particle-system-example-01/">파티클 시스템 예제 - 01</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/plugin/">plugin</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      
        
        <a class="post-tag" href="/tags/ui/">ui</a>
      
        
        <a class="post-tag" href="/tags/performance/">performance</a>
      
        
        <a class="post-tag" href="/tags/optimization/">optimization</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.

 v2.0
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/behavior-tree/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Jan  5
  

  <i class="unloaded">2021-01-05T00:26:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>비헤이비어 트리(Behavior Tree)</h3>
            <div class="text-muted small">
              <p>
                





                개념



  FSM (Finite State Machine)의 단점을 보완하기 위해 만들어진 기법
  FSM에서는 상태 전이 조건을 모두 각각의 상태에서 검사하지만, BT에서는 상태 동작 뿐만 아니라 전이 조건도 노드로 관리한다.
  노드 그래프를 통해 시각화하거나 params, 빌더 패턴 등을 활용하여 스크립트 내에서도 가독성 좋게 구성할 수 있다...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/ray-marching/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Jan 19
  

  <i class="unloaded">2021-01-19T23:15:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>레이 마칭(Ray Marching)</h3>
            <div class="text-muted small">
              <p>
                





                레이 마칭이란?



  
    폴리곤의 정점 데이터를 이용하는 기존의 3D 렌더링 방식과는 달리, 레이를 전진시켜(Ray Marching) 표면의 정보를 얻어 오브젝트를 그려내는 기법
  
  
    레이 마칭의 모든 오브젝트들은 폴리곤이 아닌 거리 함수(SDF : Signed Distance Function)로 표면의 정보가 계산된다.
  

...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/fog-of-war/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Jan 20
  

  <i class="unloaded">2021-01-20T21:00:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>전장의 안개(Fog of War)</h3>
            <div class="text-muted small">
              <p>
                





                목차



  1. 개념
  2. 구현 방법
  3. 타일맵을 이용한 구현
  4. 구현 결과
  5. 프로파일링, 최적화
  6. Reference




개념



  맵과 크기가 동일한 RGBA(0, 0, 0, a)의 텍스쳐를 이용해 지정한 유닛들의 주변시야를 표현한다.
  지정한 유닛이 현재 위치한 원형 범위 내 영역들은 a = 0,
  지정한...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.

  v2.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/unity-particle-system-example-01/" class="btn btn-outline-primary">
    <p>파티클 시스템 예제 - 01</p>
  </a>
  

  
  <a href="/posts/unity-editor-api-memo/" class="btn btn-outline-primary">
    <p>유니티 에디터 관련 유용한 스크립트, 팁 모음</p>
  </a>
  

</div>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



  <!-- image lazy load: https://github.com/ApoorvSaxena/lozad.js -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://github.com/rito15">Rito15</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-xl-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/plugin/">plugin</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      
        
        <a class="post-tag" href="/tags/ui/">ui</a>
      
        
        <a class="post-tag" href="/tags/performance/">performance</a>
      
        
        <a class="post-tag" href="/tags/optimization/">optimization</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  $(function() {
    let initTheme = "default";

    if ($("html[mode=dark]").length > 0
      || ($("html[mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://rito15.github.io{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    <div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div>    <div><i class="fa fa-tag fa-fw"></i>{tags}</div>  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>'
});
</script>


  </body>

</html>

