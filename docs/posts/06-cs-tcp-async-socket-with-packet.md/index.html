<!DOCTYPE html>



<html lang="en" 
  
    mode="dark"
  
>

  <!--
  The Head
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme" content="Chirpy v2.7.2">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기" />
<meta name="author" content="Rito15" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="이전 포스팅에서 이어집니다." />
<meta property="og:description" content="이전 포스팅에서 이어집니다." />
<link rel="canonical" href="https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/" />
<meta property="og:url" content="https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/" />
<meta property="og:site_name" content="Rito15" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-02T00:06:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"description":"이전 포스팅에서 이어집니다.","datePublished":"2021-08-02T00:06:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/"},"url":"https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/","author":{"@type":"Person","name":"Rito15"},"headline":"TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기","dateModified":"2021-08-03T03:50:36+09:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기 | Rito15
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2019 Cotes Chung
  Published under the MIT license
-->



<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->






<link rel="preload" href="/assets/css/post.css" as="style">
<link rel="stylesheet" href="/assets/css/post.css">


  
    <link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css">
    <link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" />
  



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
  Chirpy v2.3
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT Licensed
-->





<script async src="/assets/js/post.min.js"></script>


  <!-- MathJax -->
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>





</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/favicons/android-icon-192x192.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Rito15</a>
    </div>

    <div class="site-subtitle font-italic">Unity Csharp Developer</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/tabs/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tabs/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/rito15" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ghdtkals15','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">
      
        
        <span>
          <a href="/">
            Posts
          </a>
        </span>
        
      

      
        <span>TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기</span>
      

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Mon, Aug  2, 2021, 12:06 AM +0900"
  >

  
  

  
    Aug  2
  

  <i class="unloaded">2021-08-02T00:06:00+09:00</i>

</span>
          by
          <span class="author">
            Rito15
          </span>
        </div>

        <div>
          <!-- lastmod -->
          
          <span>
            Updated
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago lastmod"
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Tue, Aug  3, 2021,  3:50 AM +0900"
  >

  
  

  
    Aug  3
  

  <i class="unloaded">2021-08-03T03:50:36+09:00</i>

</span>
          </span>
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->






<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3917 words">21 min</span>


          <!-- page views -->
          

          <!-- HITS -->
          &nbsp;
          <a href="https://hits.seeyoufarm.com"><img min-width="94" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/%2F&count_bg=%23AC58FA&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=views&edge_flat=false"/></a> 

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <ul>
  <li><a href="../05-cs-tcp-async-socket-basic.md/">이전 포스팅</a>에서 이어집니다.</li>
</ul>

<p><br /></p>

<h1 id="receivebuffer-sendbuffer">ReceiveBuffer, SendBuffer</h1>
<hr />

<ul>
  <li>소켓 통신을 통한 데이터 전달 시 단순히 <code class="language-plaintext highlighter-rouge">byte[]</code>를 주고 받는 것에서 그치지 않고, 정말로 ‘패킷’을 주고 받기 위해 필요하다.</li>
</ul>

<p><br /></p>

<h1 id="receivebuffer-클래스">ReceiveBuffer 클래스</h1>
<hr />

<ul>
  <li>
    <p>각 세션마다 하나의 <code class="language-plaintext highlighter-rouge">ReceiveBuffer</code> 객체를 갖는다.</p>
  </li>
  <li>
    <p>TCP 소켓 통신을 통해 수신한 패킷이 완전하지 않을 경우를 대비해 사용된다.</p>
  </li>
  <li>
    <p>패킷을 수신하자마자 이를 완전히 처리하는 것이 아니라, <code class="language-plaintext highlighter-rouge">ReceiveBuffer</code>에 차례로 저장한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ReceiveBuffer</code> 앞부분부터 패킷의 헤더를 확인하여, 지정된 길이만큼 패킷이 완전히 도착한 것이 확인된 경우에만 해당 패킷을 처리하고 <code class="language-plaintext highlighter-rouge">ReceiveBuffer</code>에서 제거한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Read Cursor</code>와 <code class="language-plaintext highlighter-rouge">Write Cursor</code>를 갖는다.</p>
  </li>
  <li>
    <p>새로운 데이터를 버퍼 내에 저장하면, 그 길이만큼 <code class="language-plaintext highlighter-rouge">Write Cursor</code>를 뒤로 이동한다.</p>
  </li>
  <li>
    <p>버퍼 내의 데이터를 읽으면, 그 길이만큼 <code class="language-plaintext highlighter-rouge">Read Cursor</code>를 뒤로 이동한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Read Cursor</code>의 항상 <code class="language-plaintext highlighter-rouge">Write Cursor</code>와 같거나 더 앞에 위치한다.</p>
  </li>
</ul>

<p><br /></p>

<details>
  <summary> 
ReceiveBuffer.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt; 수신된 패킷을 완성하기 위한 임시 버퍼 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ReceiveBuffer</span>
<span class="p">{</span>
    <span class="c1">// * Example</span>
    <span class="c1">// [][][][r][][][][w][][] Read : 3, Write : 7</span>
    <span class="c1">//       [r][][][]        Readable Size   : 4</span>
    <span class="c1">//                [w][][] Writable Size   : 3</span>
    <span class="k">private</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">_buffer</span><span class="p">;</span>

    <span class="k">private</span> <span class="kt">int</span> <span class="n">_readPos</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_writePos</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_bufferSize</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ReceiveBuffer</span><span class="p">(</span><span class="kt">int</span> <span class="n">bufferSize</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_bufferSize</span> <span class="p">=</span> <span class="n">bufferSize</span><span class="p">;</span>
        <span class="n">_buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 읽을 수 있는 실제 데이터 길이 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ReadableSize</span> <span class="p">=&gt;</span> <span class="n">_writePos</span> <span class="p">-</span> <span class="n">_readPos</span><span class="p">;</span>

    <span class="c1">/// &lt;summary&gt; 새롭게 쓸 수 있는 여유 버퍼 길이 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">WritableSize</span> <span class="p">=&gt;</span> <span class="n">_bufferSize</span> <span class="p">-</span> <span class="n">_writePos</span><span class="p">;</span>

    <span class="c1">/// &lt;summary&gt; 읽을 수 있는 실제 데이터 영역 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;</span> <span class="n">ReadableSegment</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;(</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">_readPos</span><span class="p">,</span> <span class="n">ReadableSize</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 새로운 데이터를 작성할 수 있는 빈 영역 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;</span> <span class="n">WritableSegment</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;(</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">_writePos</span><span class="p">,</span> <span class="n">WritableSize</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; Read, Write 커서를 모두 맨 앞으로 당겨오기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Refresh</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">dataSize</span> <span class="p">=</span> <span class="n">ReadableSize</span><span class="p">;</span>

        <span class="c1">// readPos, writePos가 같은 위치에 있는 경우</span>
        <span class="c1">// 잔여 데이터 건들 필요 없이 두 커서만 모두 가장 앞으로 이동</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dataSize</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_readPos</span> <span class="p">=</span> <span class="n">_writePos</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// 읽을 수 있는 데이터가 존재할 경우</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// _readPos로부터 dataSize만큼의 길이를 시작 위치(Offset)로 복사</span>
            <span class="n">Array</span><span class="p">.</span><span class="nf">Copy</span><span class="p">(</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">_readPos</span><span class="p">,</span> <span class="n">_buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">dataSize</span><span class="p">);</span>

            <span class="c1">// 커서 위치를 앞으로 당겨주기</span>
            <span class="n">_readPos</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">_writePos</span> <span class="p">=</span> <span class="n">dataSize</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 원하는 크기만큼 읽을 수 있는지 여부 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsReadable</span><span class="p">(</span><span class="kt">int</span> <span class="n">desiredSize</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">desiredSize</span> <span class="p">&gt;=</span> <span class="n">ReadableSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 원하는 크기만큼 쓸 수 있는지 여부 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsWritable</span><span class="p">(</span><span class="kt">int</span> <span class="n">desiredSize</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">desiredSize</span> <span class="p">&gt;=</span> <span class="n">WritableSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 입력한 길이만큼 Read 커서를 이동시키고, 성공 여부 반환 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnRead</span><span class="p">(</span><span class="kt">int</span> <span class="n">numOfBytes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numOfBytes</span> <span class="p">&gt;</span> <span class="n">ReadableSize</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

        <span class="n">_readPos</span> <span class="p">+=</span> <span class="n">numOfBytes</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 입력한 길이만큼 Write 커서를 이동시키고, 성공 여부 반환 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">OnWrite</span><span class="p">(</span><span class="kt">int</span> <span class="n">numOfBytes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numOfBytes</span> <span class="p">&gt;</span> <span class="n">WritableSize</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>

        <span class="n">_writePos</span> <span class="p">+=</span> <span class="n">numOfBytes</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ReceiveBufferException</span> <span class="p">:</span> <span class="n">Exception</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">_message</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="n">Message</span> <span class="p">=&gt;</span> <span class="n">_message</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ReceiveBufferException</span><span class="p">(</span><span class="kt">string</span> <span class="n">msg</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_message</span> <span class="p">=</span> <span class="n">msg</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="sendbuffer-클래스">SendBuffer 클래스</h1>
<hr />

<ul>
  <li>
    <p>전송할 패킷을 완성하기 위한 임시 버퍼로 사용된다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">byte[]</code> 타입의 데이터들을 <code class="language-plaintext highlighter-rouge">SendBuffer</code>에 순서대로 저장한 후, 하나의 패킷으로 전송하게 된다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Read Cursor</code>와 <code class="language-plaintext highlighter-rouge">Write Cursor</code>를 갖는다.</p>
  </li>
  <li>
    <p>새로운 데이터를 버퍼 내에 저장하면, 그 길이만큼 <code class="language-plaintext highlighter-rouge">Write Cursor</code>를 뒤로 이동한다.</p>
  </li>
  <li>
    <p>버퍼 내의 데이터를 읽으면, 그 길이만큼 <code class="language-plaintext highlighter-rouge">Read Cursor</code>를 뒤로 이동한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Read Cursor</code>의 항상 <code class="language-plaintext highlighter-rouge">Write Cursor</code>와 같거나 더 앞에 위치한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Receive</code>와 달리 <code class="language-plaintext highlighter-rouge">Send</code>는 여러 스레드가 동시에 수행할 수 있으므로, <code class="language-plaintext highlighter-rouge">SendBuffer</code>를 <code class="language-plaintext highlighter-rouge">TLS</code>에 저장하여 각각의 스레드마다 고유의 <code class="language-plaintext highlighter-rouge">SendBuffer</code>를 갖도록 한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">TLS</code>를 간편히 사용하기 위해 중첩 정적 클래스 <code class="language-plaintext highlighter-rouge">Factory</code>를 제공한다.</p>
  </li>
</ul>

<p><br /></p>

<details>
  <summary> 
SendBuffer.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">ByteSegment</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;;</span>

<span class="c1">/// &lt;summary&gt; 전송 시 패킷을 조립하기 위한 임시 버퍼 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">SendBuffer</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt; Send Buffer를 TLS로 간편히 제공하기 위한 정적 클래스 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Factory</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">ThreadLocal</span><span class="p">&lt;</span><span class="n">SendBuffer</span><span class="p">&gt;</span> <span class="n">CurrentBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ThreadLocal</span><span class="p">&lt;</span><span class="n">SendBuffer</span><span class="p">&gt;(()</span> <span class="p">=&gt;</span> <span class="k">null</span><span class="p">);</span>

        <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">ChunkSize</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">4096</span> <span class="p">*</span> <span class="m">100</span><span class="p">;</span>

        <span class="c1">/// &lt;summary&gt; 버퍼에 새로운 데이터 작성하기 &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 초기 접근 시 버퍼 새로 생성</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SendBuffer</span><span class="p">(</span><span class="n">ChunkSize</span><span class="p">);</span>

            <span class="c1">// 여유 공간이 없는 경우 버퍼 새로 생성</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">CheckWritableSize</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
                <span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SendBuffer</span><span class="p">(</span><span class="n">ChunkSize</span><span class="p">);</span>

            <span class="c1">// 버퍼에 쓰기</span>
            <span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="k">params</span> <span class="kt">byte</span><span class="p">[][]</span> <span class="n">data</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">data</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">Write</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt; 버퍼에서 읽을 수 있는 모든 데이터 읽어오기 &lt;/summary&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">ByteSegment</span> <span class="nf">Read</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">$"Read 이전에 Write를 먼저 수행해야 합니다."</span><span class="p">);</span>

            <span class="k">return</span> <span class="n">CurrentBuffer</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Read</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// [][][r][][][][w][][][]</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">_buffer</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_readPos</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_writePos</span><span class="p">;</span>

    <span class="c1">/// &lt;summary&gt; 데이터를 새롭게 추가할 수 있는 여유 공간 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">WritableSize</span> <span class="p">=&gt;</span> <span class="n">_buffer</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="n">_writePos</span><span class="p">;</span>

    <span class="c1">/// &lt;summary&gt; 데이터를 읽을 수 있는 길이 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ReadableSize</span> <span class="p">=&gt;</span> <span class="n">_writePos</span> <span class="p">-</span> <span class="n">_readPos</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">SendBuffer</span><span class="p">(</span><span class="kt">int</span> <span class="n">bufferSize</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">bufferSize</span><span class="p">];</span>
        <span class="n">_readPos</span> <span class="p">=</span> <span class="n">_writePos</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 해당 길이만큼 버퍼에 쓸 수 있는지 검사 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">CheckWritableSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">WritableSize</span> <span class="p">&gt;=</span> <span class="n">len</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; Send Buffer에 새로운 데이터 작성하기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="kt">byte</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="p">&gt;</span> <span class="n">WritableSize</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="s">$"Send Buffer에 쓰려는 데이터의 길이(</span><span class="p">{</span><span class="n">len</span><span class="p">}</span><span class="s">)가"</span> <span class="p">+</span>
                <span class="s">$" 버퍼의 여유 길이(</span><span class="p">{</span><span class="n">_buffer</span><span class="p">.</span><span class="n">Length</span><span class="p">}</span><span class="s">)보다 큽니다."</span><span class="p">);</span>

        <span class="c1">// Write Pos부터 len 길이만큼 버퍼에 쓰기</span>
        <span class="n">Array</span><span class="p">.</span><span class="nf">Copy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">_buffer</span><span class="p">,</span> <span class="n">_writePos</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

        <span class="c1">// Write Pos 이동</span>
        <span class="n">_writePos</span> <span class="p">+=</span> <span class="n">len</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 버퍼에 가장 최근에 작성된 데이터 모두 읽어오기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="n">ByteSegment</span> <span class="nf">Read</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ReadableSize</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IndexOutOfRangeException</span><span class="p">(</span><span class="s">$"Send Buffer에서 읽을 수 있는 데이터가 없습니다."</span> <span class="p">+</span>
                <span class="s">$" (Read Pos : </span><span class="p">{</span><span class="n">_readPos</span><span class="p">}</span><span class="s">, Write Pos : </span><span class="p">{</span><span class="n">_writePos</span><span class="p">}</span><span class="s">)"</span><span class="p">);</span>

        <span class="c1">// 이전의 데이터 캐싱</span>
        <span class="kt">int</span> <span class="n">readPos</span> <span class="p">=</span> <span class="n">_readPos</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">readableSize</span> <span class="p">=</span> <span class="n">ReadableSize</span><span class="p">;</span>

        <span class="c1">// Read Pos 이동</span>
        <span class="n">_readPos</span> <span class="p">=</span> <span class="n">_writePos</span><span class="p">;</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">ByteSegment</span><span class="p">(</span><span class="n">_buffer</span><span class="p">,</span> <span class="n">readPos</span><span class="p">,</span> <span class="n">readableSize</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="session-클래스-수정">Session 클래스 수정</h1>
<hr />

<h2 id="1-sendqueue를-통한-혼잡-제어"><strong>[1] SendQueue를 통한 혼잡 제어</strong></h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Connect</code>, <code class="language-plaintext highlighter-rouge">Receive</code> 등의 기능과 달리 <code class="language-plaintext highlighter-rouge">Send</code>는 같은 순간에 수많은 스레드가 동시에 실행할 수 있다.</p>
  </li>
  <li>
    <p>이렇게 되면 극심한 성능 저하가 발생할 수 있으므로, 한 번에 한 스레드만 전송하도록 제한한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">lock</code>을 통해 메모리 동기화를 수행한 뒤, <code class="language-plaintext highlighter-rouge">Send</code>를 시도할 때 일단 <code class="language-plaintext highlighter-rouge">SendQueue</code>에 저장한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SendQueue</code>에 저장하는 데 성공한 스레드는 이어 <code class="language-plaintext highlighter-rouge">SendQueue</code>를 확인하여, 큐에 담긴 내용을 모두 전송하도록 구현한다.</p>
  </li>
</ul>

<p><br /></p>

<h2 id="2-sendbufferlist를-통한-묶음-전송"><strong>[2] SendBufferList를 통한 묶음 전송</strong></h2>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">SendQueue</code>를 통해 한 번에 하나의 스레드만 전송하도록 할 경우, 혼잡으로 인한 성능 저하는 해결되지만 오히려 전송이 딜레이가 발생할 수 있다는 큰 문제점이 생긴다.</p>
  </li>
  <li>
    <p>소켓에는 한 번에 하나의 <code class="language-plaintext highlighter-rouge">byte[]</code>만 전송하는 기능 뿐만 아니라 <code class="language-plaintext highlighter-rouge">BufferList</code>를 통해 여러 개의 <code class="language-plaintext highlighter-rouge">byte[]</code>를 하나로 묶어 전송하는 기능도 제공한다.</p>
  </li>
  <li>
    <p>이를 이용해, 전송을 시도하는 스레드가 <code class="language-plaintext highlighter-rouge">SendQueue</code>를 확인하여 전송할 때 큐 내부의 모든 내용을 <code class="language-plaintext highlighter-rouge">BufferList</code>에 옮겨담아 한 번에 전송하도록 구현한다.</p>
  </li>
</ul>

<p><br /></p>

<h2 id="3-receivebuffer의-사용"><strong>[3] ReceiveBuffer의 사용</strong></h2>

<ul>
  <li>
    <p>TCP 통신에서는 하나의 패킷을 한 번에 완전히 전송하지 못하고, 나누어 전송하는 경우가 발생할 수 있다.</p>
  </li>
  <li>
    <p>그런데 지금은 전송 받은 즉시 처리하므로, 나누어 수신한 패킷이 완성되지 못하고 따로따로 처리될 수 있다는 문제점이 존재한다.</p>
  </li>
  <li>
    <p>따라서 <code class="language-plaintext highlighter-rouge">ReceiveBuffer</code>를 사용하여 패킷을 일단 버퍼에 담아놓고, 패킷이 일부만 도착한 경우에는 다음에 전송되는 패킷을 버퍼에 이어 받아 완성할 수 있도록 구현한다.</p>
  </li>
</ul>

<p><br /></p>

<details>
  <summary> 
Session.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Net.Sockets</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">ByteSegment</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;;</span>

<span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Session</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">TRUE</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">FALSE</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">Socket</span> <span class="n">_socket</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_isConnected</span><span class="p">;</span>

    <span class="c1">// Sending Fields</span>
    <span class="k">private</span> <span class="n">SocketAsyncEventArgs</span> <span class="n">_sendArgs</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Queue</span><span class="p">&lt;</span><span class="n">ByteSegment</span><span class="p">&gt;</span> <span class="n">_sendQueue</span><span class="p">;</span>     <span class="c1">// 동시 전송 방지를 위한 큐</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ByteSegment</span><span class="p">&gt;</span> <span class="n">_sendBufferList</span><span class="p">;</span> <span class="c1">// 묶음 전송을 위한 리스트</span>
    <span class="k">private</span> <span class="kt">object</span> <span class="n">_sendLock</span><span class="p">;</span>

    <span class="c1">// Receiving Fields</span>
    <span class="k">private</span> <span class="n">SocketAsyncEventArgs</span> <span class="n">_recvArgs</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">ReceiveBuffer</span> <span class="n">_recvBuffer</span><span class="p">;</span>

    <span class="c1">// Event Handlers</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">OnConnected</span><span class="p">(</span><span class="n">EndPoint</span> <span class="n">endPoint</span><span class="p">);</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">OnDisconnected</span><span class="p">(</span><span class="n">EndPoint</span> <span class="n">endPoint</span><span class="p">);</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="kt">int</span> <span class="nf">OnReceived</span><span class="p">(</span><span class="n">ByteSegment</span> <span class="n">buffer</span><span class="p">);</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">OnSent</span><span class="p">(</span><span class="n">ByteSegment</span> <span class="n">buffer</span><span class="p">);</span>

    <span class="k">public</span> <span class="nf">Session</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_isConnected</span> <span class="p">=</span> <span class="n">FALSE</span><span class="p">;</span>

        <span class="n">_sendLock</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>
        <span class="n">_sendQueue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Queue</span><span class="p">&lt;</span><span class="n">ByteSegment</span><span class="p">&gt;(</span><span class="m">8</span><span class="p">);</span>
        <span class="n">_sendBufferList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ByteSegment</span><span class="p">&gt;(</span><span class="m">8</span><span class="p">);</span>

        <span class="n">_recvBuffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ReceiveBuffer</span><span class="p">(</span><span class="m">1024</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/***********************************************************************
    *                               Public Methods
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">(</span><span class="n">Socket</span> <span class="n">socket</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_socket</span> <span class="p">=</span> <span class="n">socket</span><span class="p">;</span>
        <span class="n">_isConnected</span> <span class="p">=</span> <span class="n">TRUE</span><span class="p">;</span>

        <span class="c1">// Receive</span>
        <span class="n">_recvArgs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SocketAsyncEventArgs</span><span class="p">();</span>
        <span class="n">_recvArgs</span><span class="p">.</span><span class="n">Completed</span> <span class="p">+=</span> <span class="n">OnReceiveCompleted</span><span class="p">;</span>
        <span class="c1">//_recvArgs.SetBuffer(new byte[1024], 0, 1024);</span>

        <span class="nf">BeginReceive</span><span class="p">();</span>

        <span class="c1">// Send</span>
        <span class="n">_sendArgs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SocketAsyncEventArgs</span><span class="p">();</span>
        <span class="n">_sendArgs</span><span class="p">.</span><span class="n">Completed</span> <span class="p">+=</span> <span class="n">OnSendCompleted</span><span class="p">;</span>

        <span class="c1">// 연결 완료 통보하기</span>
        <span class="c1">// 반드시 Init 끝자락에서 호출</span>
        <span class="nf">OnConnected</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">RemoteEndPoint</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 대상 소켓과의 연결 종료하기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Disconnect</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 이미 연결이 끊긴 경우 확인</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Interlocked</span><span class="p">.</span><span class="nf">Exchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">_isConnected</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">)</span> <span class="p">==</span> <span class="n">FALSE</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="nf">OnDisconnected</span><span class="p">(</span><span class="n">_socket</span><span class="p">.</span><span class="n">RemoteEndPoint</span><span class="p">);</span>

        <span class="n">_socket</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="n">SocketShutdown</span><span class="p">.</span><span class="n">Both</span><span class="p">);</span>
        <span class="n">_socket</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 연결된 대상 소켓에 데이터 전송하기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Send</span><span class="p">(</span><span class="n">ByteSegment</span> <span class="n">sendBuffer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">lock</span> <span class="p">(</span><span class="n">_sendLock</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_sendQueue</span><span class="p">.</span><span class="nf">Enqueue</span><span class="p">(</span><span class="n">sendBuffer</span><span class="p">);</span>

            <span class="c1">// Send를 수행 중인 스레드가 없을 경우, Send 수행</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_sendBufferList</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="nf">BeginSend</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; UTF-8 인코딩으로 메시지 전송하기 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">SendUTF8String</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">sendBuffer</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
        <span class="nf">Send</span><span class="p">(</span><span class="k">new</span> <span class="nf">ByteSegment</span><span class="p">(</span><span class="n">sendBuffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">sendBuffer</span><span class="p">.</span><span class="n">Length</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Protected Methods
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="k">protected</span> <span class="kt">string</span> <span class="nf">GetTimeStamp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"[HH:mm:ss]"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Send Methods
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">BeginSend</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 1. Send Queue -&gt; Buffer List에 모두 옮겨 담기</span>
        <span class="c1">//_sendBufferList.Clear(); -&gt; OnSendCompleted()에서 호출</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">_sendQueue</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ByteSegment</span> <span class="n">buffer</span> <span class="p">=</span> <span class="n">_sendQueue</span><span class="p">.</span><span class="nf">Dequeue</span><span class="p">();</span>
            <span class="n">_sendBufferList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">_sendArgs</span><span class="p">.</span><span class="n">BufferList</span> <span class="p">=</span> <span class="n">_sendBufferList</span><span class="p">;</span>

        <span class="c1">// 2. Send 수행</span>
        <span class="kt">bool</span> <span class="n">pending</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="n">pending</span> <span class="p">=</span> <span class="n">_socket</span><span class="p">.</span><span class="nf">SendAsync</span><span class="p">(</span><span class="n">_sendArgs</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ObjectDisposedException</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"대상이 연결을 강제로 종료하였습니다."</span><span class="p">);</span>
            <span class="nf">Disconnect</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pending</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 즉시 수행되는 경우</span>
            <span class="nf">OnSendCompleted</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">_sendArgs</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnSendCompleted</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">SocketAsyncEventArgs</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">lock</span> <span class="p">(</span><span class="n">_sendLock</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">byteTransferred</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">BytesTransferred</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">byteTransferred</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">args</span><span class="p">.</span><span class="n">SocketError</span> <span class="p">==</span> <span class="n">SocketError</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">try</span>
                <span class="p">{</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">buffer</span> <span class="k">in</span> <span class="n">_sendBufferList</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="nf">OnSent</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// 버퍼 리스트 비워주기(Send 수행 종료를 알리는 것과 상통)</span>
                    <span class="n">_sendBufferList</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

                    <span class="c1">// 큐에 버퍼가 더 남아있으면 Send 이어서 수행</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">_sendQueue</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"QUEUE IS NOT EMPTY : </span><span class="p">{</span><span class="n">_sendQueue</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                        <span class="nf">BeginSend</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">OnSendCompleted</span><span class="p">)}</span><span class="s">() Error : </span><span class="p">{</span><span class="n">e</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">OnSendCompleted</span><span class="p">)}</span><span class="s">() Error : "</span>
                    <span class="p">+</span> <span class="s">$"Byte Transferred [</span><span class="p">{</span><span class="n">byteTransferred</span><span class="p">}</span><span class="s">], "</span>
                    <span class="p">+</span> <span class="s">$"Error Type [</span><span class="p">{</span><span class="n">args</span><span class="p">.</span><span class="n">SocketError</span><span class="p">}</span><span class="s">]\n"</span><span class="p">;</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>

                <span class="nf">Disconnect</span><span class="p">();</span> <span class="c1">// 소켓 에러 발생 시 세션 종료</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="err">#</span><span class="n">endregion</span>
    <span class="cm">/***********************************************************************
    *                               Receive Methods
    ***********************************************************************/</span>
    <span class="err">#</span><span class="n">region</span> <span class="p">.</span>
    <span class="c1">// NOTE : Receive는 한 번의 수신이 완료되어야만 다음 수신을 준비하므로</span>
    <span class="c1">//        스레드 동기화 필요 X</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">BeginReceive</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 1. Receive Buffer의 여유 공간 참조</span>
        <span class="n">_recvBuffer</span><span class="p">.</span><span class="nf">Refresh</span><span class="p">();</span>
        <span class="n">ByteSegment</span> <span class="n">segment</span> <span class="p">=</span> <span class="n">_recvBuffer</span><span class="p">.</span><span class="n">WritableSegment</span><span class="p">;</span>
        <span class="n">_recvArgs</span><span class="p">.</span><span class="nf">SetBuffer</span><span class="p">(</span><span class="n">segment</span><span class="p">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">segment</span><span class="p">.</span><span class="n">Offset</span><span class="p">,</span> <span class="n">segment</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>

        <span class="c1">// 2. Receive 수행</span>
        <span class="kt">bool</span> <span class="n">pending</span> <span class="p">=</span> <span class="n">_socket</span><span class="p">.</span><span class="nf">ReceiveAsync</span><span class="p">(</span><span class="n">_recvArgs</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pending</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 즉시 수행되는 경우</span>
            <span class="nf">OnReceiveCompleted</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">_recvArgs</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnReceiveCompleted</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">SocketAsyncEventArgs</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">byteTransferred</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">BytesTransferred</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">byteTransferred</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">args</span><span class="p">.</span><span class="n">SocketError</span> <span class="p">==</span> <span class="n">SocketError</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// 1. Receive Buffer의 Write 커서 이동</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_recvBuffer</span><span class="p">.</span><span class="nf">OnWrite</span><span class="p">(</span><span class="n">byteTransferred</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ReceiveBufferException</span><span class="p">(</span><span class="s">$"버퍼에 쓸 수 있는 잔여 공간이 없습니다 - "</span> <span class="p">+</span>
                        <span class="s">$"Writable Size : </span><span class="p">{</span><span class="n">_recvBuffer</span><span class="p">.</span><span class="n">WritableSize</span><span class="p">}</span><span class="s">, Byte Transferred : </span><span class="p">{</span><span class="n">byteTransferred</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// 2. 컨텐츠 쪽에 데이터를 넘겨주고, 처리된 데이터 길이 반환받기</span>
                <span class="c1">// OnReceived() 메소드에서 패킷을 분석하여, 불완전한 패킷인 경우 0을 반환한다.</span>
                <span class="kt">int</span> <span class="n">processedLen</span> <span class="p">=</span> <span class="nf">OnReceived</span><span class="p">(</span><span class="n">_recvBuffer</span><span class="p">.</span><span class="n">ReadableSegment</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">processedLen</span> <span class="p">&lt;</span> <span class="m">0</span> <span class="p">||</span> <span class="n">processedLen</span> <span class="p">&gt;</span> <span class="n">_recvBuffer</span><span class="p">.</span><span class="n">ReadableSize</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ReceiveBufferException</span><span class="p">(</span><span class="s">$"버퍼를 읽는 데 실패하였습니다 - "</span> <span class="p">+</span>
                        <span class="s">$"Readable Size : </span><span class="p">{</span><span class="n">_recvBuffer</span><span class="p">.</span><span class="n">ReadableSize</span><span class="p">}</span><span class="s">, 읽으려는 길이 : </span><span class="p">{</span><span class="n">processedLen</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// 3. 처리된 데이터 길이만큼 Receive Buffer의 Read 커서 이동</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">_recvBuffer</span><span class="p">.</span><span class="nf">OnRead</span><span class="p">(</span><span class="n">processedLen</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ReceiveBufferException</span><span class="p">(</span><span class="s">$"버퍼에서 읽을 수 있는 데이터 길이보다 입력한 길이가 더 큽니다 - "</span> <span class="p">+</span>
                        <span class="s">$"Readable Size : </span><span class="p">{</span><span class="n">_recvBuffer</span><span class="p">.</span><span class="n">ReadableSize</span><span class="p">}</span><span class="s">, 읽으려는 길이 : </span><span class="p">{</span><span class="n">processedLen</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// Receive 재시작</span>
                <span class="nf">BeginReceive</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">OnReceiveCompleted</span><span class="p">)}</span><span class="s">() Error : </span><span class="p">{</span><span class="n">e</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="nf">Disconnect</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">msg</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">OnReceiveCompleted</span><span class="p">)}</span><span class="s">() Error : "</span>
                    <span class="p">+</span> <span class="s">$"Byte Transferred [</span><span class="p">{</span><span class="n">byteTransferred</span><span class="p">}</span><span class="s">], "</span>
                    <span class="p">+</span> <span class="s">$"Error Type [</span><span class="p">{</span><span class="n">args</span><span class="p">.</span><span class="n">SocketError</span><span class="p">}</span><span class="s">]\n"</span><span class="p">;</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>

            <span class="nf">Disconnect</span><span class="p">();</span> <span class="c1">// 소켓 에러 발생 시 세션 종료</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="err">#</span><span class="n">endregion</span>

<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="packet-클래스">Packet 클래스</h1>
<hr />

<ul>
  <li>
    <p>패킷의 맨 앞부분에는 크기 정보, 바로 뒤에 패킷의 <code class="language-plaintext highlighter-rouge">id</code>를 넣어준다.</p>
  </li>
  <li>
    <p>두 데이터의 타입을 <code class="language-plaintext highlighter-rouge">2byte</code>인 <code class="language-plaintext highlighter-rouge">ushort</code>로 지정하여 패킷의 크기를 최대한 줄여준다.</p>
  </li>
  <li>
    <p>다양한 종류의 패킷을 만들더라도, 이 클래스를 상속하여 공통 부분은 유지한 채로 구현한다.</p>
  </li>
</ul>

<p><br /></p>

<details>
  <summary> 
Packet.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Packet</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">ushort</span> <span class="n">size</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">ushort</span> <span class="n">id</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="packetsession-클래스">PacketSession 클래스</h1>
<hr />

<ul>
  <li>
    <p>세션 중에서도 패킷을 사용하는 세션을 따로 구분하여 작성한다.</p>
  </li>
  <li>
    <p>전달받은 내용을 <code class="language-plaintext highlighter-rouge">OnReceived()</code> 메소드에서 확인하여, 완전한 패킷을 조립할 수 있는 경우에만 <code class="language-plaintext highlighter-rouge">OnReceivePacket()</code> 메소드로 넘겨 처리한다.</p>
  </li>
</ul>

<p><br /></p>

<details>
  <summary> 
PacketSession.cs
</summary>

  <div class="language-cs highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">ByteSegment</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">ArraySegment</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;;</span>

<span class="c1">/// &lt;summary&gt; 패킷을 사용하는 세션 &lt;/summary&gt;</span>
<span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">PacketSession</span> <span class="p">:</span> <span class="n">Session</span>
<span class="p">{</span>
    <span class="c1">/// &lt;summary&gt; 패킷 헤더 길이 &lt;/summary&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">ushort</span> <span class="n">HeaderSize</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">OnReceived</span><span class="p">(</span><span class="n">ByteSegment</span> <span class="n">buffer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// 처리한 데이터 길이</span>
        <span class="kt">int</span> <span class="n">processedLen</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// 1. 헤더 파싱조차 불가능하게 작은 데이터가 온 경우, 처리 X</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Count</span> <span class="p">&lt;</span> <span class="n">HeaderSize</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="c1">// 헤더를 확인하여 패킷이 완전히 도착했는지 여부 확인</span>
            <span class="kt">ushort</span> <span class="n">dataLen</span> <span class="p">=</span> <span class="n">BitConverter</span><span class="p">.</span><span class="nf">ToUInt16</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Offset</span><span class="p">);</span>

            <span class="c1">// 2. 아직 완전한 패킷이 도착한 것이 아닌 경우, 처리 X</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Count</span> <span class="p">&lt;</span> <span class="n">dataLen</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="c1">// 3. 완전한 패킷 처리</span>
            <span class="nf">OnReceivePacket</span><span class="p">(</span><span class="k">new</span> <span class="nf">ByteSegment</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Offset</span><span class="p">,</span> <span class="n">dataLen</span><span class="p">));</span>
            <span class="n">processedLen</span> <span class="p">+=</span> <span class="n">dataLen</span><span class="p">;</span>

            <span class="c1">// 4. 다음 패킷 확인(Offset 이동)</span>
            <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ByteSegment</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Offset</span> <span class="p">+</span> <span class="n">dataLen</span><span class="p">,</span> <span class="n">buffer</span><span class="p">.</span><span class="n">Count</span> <span class="p">-</span> <span class="n">dataLen</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">processedLen</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt; 완전한 하나의 패킷 처리 &lt;/summary&gt;</span>
    <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">OnReceivePacket</span><span class="p">(</span><span class="n">ByteSegment</span> <span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<p><br /></p>

<h1 id="references">References</h1>
<hr />
<ul>
  <li><a href="https://www.inflearn.com/course/유니티-mmorpg-개발-part4">https://www.inflearn.com/course/유니티-mmorpg-개발-part4</a></li>
</ul>



      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/c/'>C#</a>,
            <a href='/categories/c-socket/'>C# Socket</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/csharp/"
            class="post-tag no-text-decoration" >csharp</a>
          
          <a href="/tags/thread/"
            class="post-tag no-text-decoration" >thread</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet

 v2.1
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기 - Rito15&url=https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기 - Rito15&u=https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=TCP 비동기 소켓 서버, 클라이언트 - 패킷 고려하기 - Rito15&url=https://rito15.github.io/posts/06-cs-tcp-async-socket-with-packet.md/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/unity-amplify-screen-damage/">(Amplify) Screen Effect - Damage</a></li>
      
        
        
        
        <li><a href="/posts/unity-amplify-screen-hexagons/">(Amplify) Screen Effect - Hexagonal Pattern</a></li>
      
        
        
        
        <li><a href="/posts/unity-amplify-screen-shake/">(Amplify) Screen Effect - Shake</a></li>
      
        
        
        
        <li><a href="/posts/unity-screen-effect-controller/">Screen Effect Controller(스크린 이펙트, 포스트 프로세싱)</a></li>
      
        
        
        
        <li><a href="/posts/unity-shader-concept/">초보자를 위한 쉐이더 개념 간단 정리</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/editor/">editor</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/memo/">memo</a>
      
        
        <a class="post-tag" href="/tags/thread/">thread</a>
      
        
        <a class="post-tag" href="/tags/plugin/">plugin</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.

 v2.0
 https://github.com/cotes2020/jekyll-theme-chirpy
 © 2019 Cotes Chung
 Published under the MIT License
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/01-cs-tcp-ip-4-layer/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Aug  2
  

  <i class="unloaded">2021-08-02T00:01:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>TCP/IP 4 계층</h3>
            <div class="text-muted small">
              <p>
                





                Note






OSI 7 Layer


[7] Application

[6] Presentation

[5] Session

[4] Transport

[3] Network

[2] Data Link

[1] Physical



TCP/IP 4 Layer


[4] Application

  OSI 7 Layer의 Application(7), ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/02-cs-tcp-udp-protocols.md/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Aug  2
  

  <i class="unloaded">2021-08-02T00:02:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>TCP, UDP 프로토콜</h3>
            <div class="text-muted small">
              <p>
                





                TCP, UDP 프로토콜



  
    OSI 7 Layer 중 4번째, TCP/IP 4 Layer 중 3번째인 Transport 계층의 통신을 위한 프로토콜
  
  
    IP 주소와 포트 번호를 통해 대상을 식별한다.
  




TCP(Transmission Control Protocol)


개념

  데이터를 메시지 형태로 전송하기 위...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/03-cs-tcp-socket-server-client-basic.md/">
          <div class="card-body">
            <!--
  Date format snippet

  v2.4.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->
<span class="timeago small"
  >

  
  

  
    Aug  2
  

  <i class="unloaded">2021-08-02T00:03:00+09:00</i>

</span>
            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>TCP 소켓 서버, 클라이언트 기본</h3>
            <div class="text-muted small">
              <p>
                





                소켓 정의


프로토콜

  데이터 전송을 위한 규약이며, 대표적으로 TCP와 UDP가 있다.


IP

  컴퓨터에 부여된 논리적 식별 주소


Port

  네트워크 상에서 통신하기 위해 호스트 내부적으로 프로세스가 할당받는 고유 번호
  같은 컴퓨터 내에서 프로세스를 식별하기 위한 번호




소켓 통신 과정


서버

  서버 IP 주소, 포트...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.

  v2.1
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2020 Cotes Chung
  MIT License
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/05-cs-tcp-async-socket-basic.md/" class="btn btn-outline-primary">
    <p>TCP 비동기 소켓 서버, 클라이언트 기본</p>
  </a>
  

  
  <a href="/posts/cs-tcp-async-socket-chatting/" class="btn btn-outline-primary">
    <p>TCP 비동기 소켓으로 간단한 콘솔 채팅 구현하기</p>
  </a>
  

</div>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->





        <!--
  The Footer
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://github.com/rito15">Rito15</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-xl-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/csharp/">csharp</a>
      
        
        <a class="post-tag" href="/tags/unity/">unity</a>
      
        
        <a class="post-tag" href="/tags/editor/">editor</a>
      
        
        <a class="post-tag" href="/tags/shader/">shader</a>
      
        
        <a class="post-tag" href="/tags/graphics/">graphics</a>
      
        
        <a class="post-tag" href="/tags/opengl/">opengl</a>
      
        
        <a class="post-tag" href="/tags/memo/">memo</a>
      
        
        <a class="post-tag" href="/tags/thread/">thread</a>
      
        
        <a class="post-tag" href="/tags/plugin/">plugin</a>
      
        
        <a class="post-tag" href="/tags/particle/">particle</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    
      <!--
  mermaid-js loader
-->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  $(function() {
    let initTheme = "default";

    if ($("html[mode=dark]").length > 0
      || ($("html[mode]").length == 0
        && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) {
      initTheme = "dark";
    }

    let mermaidConf = {
      theme: initTheme  /* <default|dark|forest|neutral> */
    };

    /* Markdown converts to HTML */
    $("pre").has("code.language-mermaid").each(function() {
      let svgCode = $(this).children().html();
      $(this).addClass("unloaded");
      $(this).after(`<div class=\"mermaid\">${svgCode}</div>`);
    });

    mermaid.initialize(mermaidConf);
  });
</script>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://rito15.github.io{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    <div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div>    <div><i class="fa fa-tag fa-fw"></i>{tags}</div>  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>'
});
</script>


    <!-- 2021-06-29 추가 : 애널리틱스 적용 -->
    <!--
  The GA snippet
  v2.0
  https://github.com/cotes2020/jekyll-theme-chirpy
  © 2017-2019 Cotes Chung
  MIT License
-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JV8DN2JPP7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JV8DN2JPP7');
</script>

  </body>

</html>

